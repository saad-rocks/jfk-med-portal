import{f as e,u as s,i as a,e as t,j as r,k as l,l as n,g as i,m as o}from"./index-SvUTDYpM.js";import{r as d}from"./react-c0U51vzo.js";import{C as c}from"./card-C7UMvtm_.js";import{B as m}from"./button-C_oKDOXG.js";import{I as u}from"./input-Cf836u6s.js";import{B as x}from"./badge-mKe8BOon.js";import{M as h}from"./medical-modal-FnZGgc9T.js";import{d as g,e as p,T as j,k as f}from"./firebase-Bz9ybdfi.js";import{a1 as v,c as b,G as N,b as y,a0 as w,S as C,J as k,U as S,O as A,$ as M,k as D,a2 as U,C as I,d as L}from"./icons-C41eJsKq.js";import"./utils-CCUt_dAN.js";import"./utils-DYr6ILV-.js";const E=[{uid:"seed-student-1",name:"Sarah Johnson",email:"sarah.johnson@student.jfk.edu",phone:"+1 (555) 123-4567",role:"student",status:"active",createdAt:j.now(),updatedAt:j.now(),mdYear:"MD-2",studentId:"JFK2024001",gpa:3.8,enrollmentDate:j.now()},{uid:"seed-student-2",name:"Michael Chen",email:"michael.chen@student.jfk.edu",phone:"+1 (555) 234-5678",role:"student",status:"active",createdAt:j.now(),updatedAt:j.now(),mdYear:"MD-1",studentId:"JFK2024002",gpa:3.9,enrollmentDate:j.now()},{uid:"seed-teacher-1",name:"Dr. Robert Smith",email:"robert.smith@jfk.edu",phone:"+1 (555) 456-7890",role:"teacher",status:"active",createdAt:j.now(),updatedAt:j.now(),department:"Internal Medicine",specialization:"Cardiology",employeeId:"JFK-FAC-001",hireDate:j.now()},{uid:"seed-admin-1",name:"Admin Wilson",email:"admin@jfk.edu",phone:"+1 (555) 678-9012",role:"admin",status:"active",createdAt:j.now(),updatedAt:j.now(),adminLevel:"super",permissions:["user_management","course_management","system_settings"]}];function F(){const{role:h}=s(),[j,L]=d.useState("categories"),[F,z]=d.useState(null),[Y,$]=d.useState(""),[T,q]=d.useState("all"),[J,R]=d.useState("all"),[B,G]=d.useState(!1),[K,_]=d.useState(null),[O,Q]=d.useState([]),[W,H]=d.useState(!0),[V,X]=d.useState({totalUsers:0,students:0,teachers:0,admins:0,activeUsers:0}),[Z,ee]=d.useState(null),se=d.useCallback(async()=>{try{let e;console.log("📊 Loading users...",F?`Role: ${F}`:"All users"),H(!0),ee(null),F?(e=await a(F),console.log(`📋 Loaded ${e.length} ${F}s:`,e)):(e=await t(),console.log(`📋 Loaded ${e.length} total users:`,e)),Q(e)}catch(e){ee(e instanceof Error?e.message:"Failed to load users"),console.error("❌ Error loading users:",e)}finally{H(!1)}},[F]),ae=async()=>{try{console.log("📈 Loading user statistics...");const e=await i();console.log("📊 User stats loaded:",e),X(e)}catch(e){console.error("❌ Error loading user stats:",e)}},te=d.useCallback(async()=>{try{await async function(){try{const s=g(e,"users");if((await p(s)).empty){console.log("🌱 Seeding initial user data...");for(const e of E)await f(s,e);console.log("✅ Seed data added successfully!")}else console.log("📊 Users collection already has data, skipping seed.")}catch(Z){console.error("❌ Error seeding user data:",Z)}}(),await se(),await ae()}catch(s){console.error("Error initializing data:",s),ee("Failed to initialize user data")}},[se]);if(d.useEffect(()=>{te()},[te]),d.useEffect(()=>{"users"===j&&se()},[F,j,se]),"admin"!==h)return r.jsx("div",{className:"p-6",children:r.jsxs(c,{className:"p-8 text-center",children:[r.jsx(v,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),r.jsx("p",{className:"text-gray-600",children:"You don't have permission to access user management."})]})});const re=O.filter(e=>(!F||e.role===F)&&(!(Y&&!e.name.toLowerCase().includes(Y.toLowerCase())&&!e.email.toLowerCase().includes(Y.toLowerCase()))&&(("all"===T||e.mdYear===T)&&("all"===J||e.department===J)))),le=e=>{switch(e){case"student":return V.students;case"teacher":return V.teachers;case"admin":return V.admins;default:return 0}},ne=e=>{z(e),L("users")};return W&&"categories"===j?r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),r.jsx("span",{className:"text-gray-600",children:"Loading user data..."})]})}):Z?r.jsx("div",{className:"p-6",children:r.jsxs(c,{className:"p-8 text-center",children:[r.jsx("div",{className:"h-16 w-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(b,{className:"h-8 w-8 text-red-500"})}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Error Loading Users"}),r.jsx("p",{className:"text-gray-600 mb-4",children:Z}),r.jsx(m,{onClick:()=>se(),children:"Try Again"})]})}):"categories"===j?r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"mb-6",children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"User Management"}),r.jsx("p",{className:"text-gray-600",children:"Manage students, teachers, and administrators"})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[r.jsx(c,{className:"p-8 hover:shadow-lg transition-all duration-300 cursor-pointer group",onClick:()=>ne("student"),children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"h-16 w-16 bg-gradient-to-r from-blue-500 to-teal-500 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300",children:r.jsx(N,{className:"h-8 w-8 text-white"})}),r.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Students"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"Medical students enrolled in the program"}),r.jsx("div",{className:"flex justify-center mb-4",children:r.jsxs(x,{variant:"secondary",className:"text-lg px-4 py-2",children:[le("student")," Total"]})}),r.jsx(m,{className:"w-full group-hover:bg-blue-600 transition-colors duration-300",children:"Manage Students"})]})}),r.jsx(c,{className:"p-8 hover:shadow-lg transition-all duration-300 cursor-pointer group",onClick:()=>ne("teacher"),children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"h-16 w-16 bg-gradient-to-r from-green-500 to-emerald-500 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300",children:r.jsx(y,{className:"h-8 w-8 text-white"})}),r.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Teachers"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"Faculty members and instructors"}),r.jsx("div",{className:"flex justify-center mb-4",children:r.jsxs(x,{variant:"secondary",className:"text-lg px-4 py-2",children:[le("teacher")," Total"]})}),r.jsx(m,{className:"w-full bg-green-600 hover:bg-green-700 transition-colors duration-300",children:"Manage Teachers"})]})}),r.jsx(c,{className:"p-8 hover:shadow-lg transition-all duration-300 cursor-pointer group",onClick:()=>ne("admin"),children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"h-16 w-16 bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform duration-300",children:r.jsx(v,{className:"h-8 w-8 text-white"})}),r.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Administrators"}),r.jsx("p",{className:"text-gray-600 mb-4",children:"System administrators and staff"}),r.jsx("div",{className:"flex justify-center mb-4",children:r.jsxs(x,{variant:"secondary",className:"text-lg px-4 py-2",children:[le("admin")," Total"]})}),r.jsx(m,{className:"w-full bg-purple-600 hover:bg-purple-700 transition-colors duration-300",children:"Manage Admins"})]})})]}),r.jsxs(c,{className:"p-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Statistics"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[r.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-xl",children:[r.jsx("div",{className:"text-2xl font-bold text-blue-600",children:le("student")}),r.jsx("div",{className:"text-sm text-blue-700",children:"Active Students"})]}),r.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-xl",children:[r.jsx("div",{className:"text-2xl font-bold text-green-600",children:le("teacher")}),r.jsx("div",{className:"text-sm text-green-700",children:"Faculty Members"})]}),r.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-xl",children:[r.jsx("div",{className:"text-2xl font-bold text-purple-600",children:le("admin")}),r.jsx("div",{className:"text-sm text-purple-700",children:"Administrators"})]}),r.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-xl",children:[r.jsx("div",{className:"text-2xl font-bold text-gray-600",children:V.totalUsers}),r.jsx("div",{className:"text-sm text-gray-700",children:"Total Users"})]})]})]})]}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs(m,{variant:"outline",onClick:()=>{L("categories"),z(null),$(""),q("all"),R("all")},className:"flex items-center gap-2",children:[r.jsx(w,{className:"h-4 w-4"}),"Back to Categories"]}),r.jsxs("div",{children:[r.jsxs("h1",{className:"text-2xl font-bold text-gray-900 capitalize",children:[F,"s Management"]}),r.jsxs("p",{className:"text-gray-600",children:["Manage ",F,"s in the system"]})]})]}),r.jsx(c,{className:"p-6",children:r.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[r.jsxs("div",{className:"flex flex-1 gap-4 items-center",children:[r.jsxs("div",{className:"relative flex-1 max-w-md",children:[r.jsx(C,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),r.jsx(u,{placeholder:"Search users...",value:Y,onChange:e=>$(e.target.value),className:"pl-10"})]}),"student"===F&&r.jsxs("select",{value:T,onChange:e=>q(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"all",children:"All Years"}),Array.from({length:11},(e,s)=>`MD-${s+1}`).map(e=>r.jsx("option",{value:e,children:e},e))]}),"teacher"===F&&r.jsxs("select",{value:J,onChange:e=>R(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"all",children:"All Departments"}),r.jsx("option",{value:"Internal Medicine",children:"Internal Medicine"}),r.jsx("option",{value:"Surgery",children:"Surgery"}),r.jsx("option",{value:"Pediatrics",children:"Pediatrics"}),r.jsx("option",{value:"Psychiatry",children:"Psychiatry"})]})]}),r.jsxs(m,{onClick:()=>{console.log("➕ Adding new user - setting editingUser to null"),_(null),G(!0),console.log("📝 Modal state:",{editingUser:null,showAddModal:!0})},className:"flex items-center gap-2",children:[r.jsx(k,{className:"h-4 w-4"}),"Add ",F]})]})}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:re.map(e=>r.jsxs(c,{className:"p-6 hover:shadow-lg transition-shadow duration-300",children:[r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"h-12 w-12 bg-gradient-to-r from-blue-500 to-teal-500 rounded-xl flex items-center justify-center",children:r.jsx(S,{className:"h-6 w-6 text-white"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold text-gray-900",children:e.name}),r.jsx(x,{variant:"active"===e.status?"success":"error",children:e.status})]})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(m,{size:"sm",variant:"outline",onClick:()=>(e=>{_(e),G(!0)})(e),children:r.jsx(A,{className:"h-4 w-4"})}),r.jsx(m,{size:"sm",variant:"outline",onClick:()=>e.id&&(async e=>{if(confirm("Are you sure you want to delete this user? This action cannot be undone."))try{await o(e),await se(),await ae(),alert("User deleted successfully")}catch(s){console.error("Error deleting user:",s),alert("Failed to delete user: "+(s instanceof Error?s.message:"Unknown error"))}})(e.id),className:"text-red-600 hover:text-red-700",children:r.jsx(M,{className:"h-4 w-4"})})]})]}),r.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(D,{className:"h-4 w-4"}),r.jsx("span",{children:e.email})]}),e.phone&&r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(U,{className:"h-4 w-4"}),r.jsx("span",{children:e.phone})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(I,{className:"h-4 w-4"}),r.jsxs("span",{children:["Joined ",e.createdAt instanceof Date?e.createdAt.toLocaleDateString():e.createdAt.toDate().toLocaleDateString()]})]}),"student"===e.role&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(N,{className:"h-4 w-4"}),r.jsxs("span",{children:[e.mdYear," - ID: ",e.studentId]})]}),e.gpa&&r.jsx("div",{className:"flex items-center gap-2",children:r.jsxs("span",{className:"font-medium",children:["GPA: ",e.gpa]})})]}),"teacher"===e.role&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(y,{className:"h-4 w-4"}),r.jsx("span",{children:e.department})]}),e.specialization&&r.jsx("div",{className:"flex items-center gap-2",children:r.jsx("span",{className:"font-medium",children:e.specialization})}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsxs("span",{className:"text-xs",children:["ID: ",e.employeeId]})})]}),"admin"===e.role&&r.jsx(r.Fragment,{children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(v,{className:"h-4 w-4"}),r.jsxs(x,{variant:"super"===e.adminLevel?"default":"secondary",children:[e.adminLevel," Admin"]})]})})]})]},e.id))}),0===re.length&&r.jsxs(c,{className:"p-8 text-center",children:[r.jsx(b,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No users found"}),r.jsx("p",{className:"text-gray-600",children:"Try adjusting your search or filter criteria."})]}),B&&r.jsx(P,{user:K,role:F,onClose:()=>G(!1),onSave:async e=>{try{if(console.log("💾 Saving user data:",e),K)console.log("📝 Updating user:",K.id),await l(K.id,e),console.log("✅ User updated successfully"),alert("User updated successfully");else{if(console.log("👤 Creating new user..."),!e.password||""===e.password.trim())throw new Error("Password is required for new users");console.log("🔐 Password provided:",e.password?"Yes":"No"),console.log("📧 Email:",e.email),console.log("👤 Name:",e.name),console.log("🎭 Role:",e.role);const s=await n(e);console.log("✅ User created successfully:",s),alert("User created successfully")}G(!1),console.log("🔄 Reloading users..."),await se(),await ae(),console.log("✅ Data reloaded")}catch(s){console.error("❌ Error saving user:",s),console.error("❌ Full error object:",s);let e="Unknown error";s instanceof Error&&(e=s.message,console.error("❌ Error message:",s.message),console.error("❌ Error stack:",s.stack)),alert("Failed to save user: "+e)}}})]})}function P({user:e,role:s,onClose:a,onSave:t}){console.log("🔧 UserModal props:",{user:e,role:s,isNewUser:!e});const[l,n]=d.useState({name:e?.name||"",email:e?.email||"",password:"",phone:e?.phone||"",status:e?.status||"active",mdYear:e?.mdYear||"MD-1",studentId:e?.studentId||"",gpa:e?.gpa||0,department:e?.department||"",specialization:e?.specialization||"",employeeId:e?.employeeId||"",adminLevel:e?.adminLevel||"regular"}),i=(e,s)=>{console.log(`📝 Field changed: ${e} = ${s}`);const a={...l,[e]:s};console.log("📋 Updated form data:",a),n(a)};return r.jsx(h,{isOpen:!0,onClose:a,title:`${e?"Edit":"Add"} ${s}`,description:e?"Update user information and permissions":"Create a new user account",icon:r.jsx(L,{size:24,className:"text-blue-600"}),size:"md",footer:r.jsxs("div",{className:"flex gap-4 w-full",children:[r.jsx(m,{type:"button",variant:"outline",onClick:a,className:"flex-1 h-12 font-semibold hover:bg-slate-50 border-slate-300",children:"Cancel"}),r.jsxs(m,{type:"submit",form:"user-form",className:"flex-1 h-12 font-semibold bg-gradient-to-r from-blue-600 to-teal-600 hover:from-blue-700 hover:to-teal-700 shadow-md hover:shadow-lg transition-all duration-200",children:[e?"Update":"Create"," ",s]})]}),children:r.jsxs("form",{id:"user-form",onSubmit:a=>{a.preventDefault(),l.name&&l.email?e||l.password?l.password&&l.password.length<6?alert("Password must be at least 6 characters long"):(console.log("📝 Form data being submitted:",{...l,role:s}),t({...l,role:s})):alert("Password is required for new users"):alert("Name and email are required")},className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),r.jsx(u,{value:l.name,onChange:e=>i("name",e.target.value),required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),r.jsx(u,{type:"email",value:l.email,onChange:e=>i("email",e.target.value),required:!0})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Password ",r.jsx("span",{className:"text-red-500",children:"*"}),e?" (Leave blank to keep current)":" (Required for new users)"]}),r.jsx(u,{type:"password",value:l.password,onChange:e=>{console.log("🔑 Password field changed:",e.target.value),i("password",e.target.value)},required:!e,minLength:6,placeholder:e?"Leave blank to keep current password":"Minimum 6 characters"}),r.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Current password: ",l.password?"✅ Provided":"❌ Missing"]})]}),r.jsxs("div",{className:"p-2 bg-gray-100 rounded text-xs text-gray-600",children:["Debug: user=",e?"exists":"null",", isNewUser=",e?"no":"yes"]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),r.jsx(u,{value:l.phone,onChange:e=>i("phone",e.target.value)})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),r.jsxs("select",{value:l.status,onChange:e=>i("status",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"active",children:"Active"}),r.jsx("option",{value:"inactive",children:"Inactive"}),r.jsx("option",{value:"suspended",children:"Suspended"})]})]}),"student"===s&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"MD Year"}),r.jsx("select",{value:l.mdYear,onChange:e=>i("mdYear",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:Array.from({length:11},(e,s)=>`MD-${s+1}`).map(e=>r.jsx("option",{value:e,children:e},e))})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Student ID"}),r.jsx(u,{value:l.studentId,onChange:e=>i("studentId",e.target.value)})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"GPA"}),r.jsx(u,{type:"number",step:"0.1",min:"0",max:"4",value:l.gpa,onChange:e=>i("gpa",parseFloat(e.target.value)||0)})]})]}),"teacher"===s&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Department"}),r.jsxs("select",{value:l.department,onChange:e=>i("department",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"",children:"Select Department"}),r.jsx("option",{value:"Internal Medicine",children:"Internal Medicine"}),r.jsx("option",{value:"Surgery",children:"Surgery"}),r.jsx("option",{value:"Pediatrics",children:"Pediatrics"}),r.jsx("option",{value:"Psychiatry",children:"Psychiatry"}),r.jsx("option",{value:"Emergency Medicine",children:"Emergency Medicine"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Specialization"}),r.jsx(u,{value:l.specialization,onChange:e=>i("specialization",e.target.value)})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Employee ID"}),r.jsx(u,{value:l.employeeId,onChange:e=>i("employeeId",e.target.value)})]})]}),"admin"===s&&r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Admin Level"}),r.jsxs("select",{value:l.adminLevel,onChange:e=>i("adminLevel",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"regular",children:"Regular Admin"}),r.jsx("option",{value:"super",children:"Super Admin"})]})]})]})})}export{F as default};
