import{u as e,j as s}from"./index-SvUTDYpM.js";import{r as a}from"./react-c0U51vzo.js";import{P as t}from"./PageHeader-yfs0G1du.js";import{C as r,a as n,c as i,b as l}from"./card-C7UMvtm_.js";import{B as o}from"./button-C_oKDOXG.js";import{I as c}from"./input-Cf836u6s.js";import{B as d}from"./badge-mKe8BOon.js";import{M as m}from"./medical-modal-FnZGgc9T.js";import{i as x,c as u,a as h,g,b as j,f as p,s as f,u as b,h as D}from"./sessions--x-CNuOM.js";import{a1 as N,T as y,P as w,O as v,$ as S,C}from"./icons-C41eJsKq.js";import"./firebase-Bz9ybdfi.js";import"./utils-CCUt_dAN.js";import"./utils-DYr6ILV-.js";function k(){const{role:c}=e(),[m,k]=a.useState([]),[E,F]=a.useState(!0),[T,I]=a.useState(!1),[L,A]=a.useState(null),[Y,q]=a.useState(null);a.useEffect(()=>{z()},[]);const z=async()=>{try{F(!0),q(null),await x();const e=await u();k(e)}catch(e){q(e instanceof Error?e.message:"Failed to load sessions"),console.error("Error loading sessions:",e)}finally{F(!1)}},P=()=>{A(null),I(!0)};return"admin"!==c?s.jsx("div",{className:"p-6",children:s.jsxs(r,{className:"p-8 text-center",children:[s.jsx(N,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),s.jsx("p",{className:"text-gray-600",children:"You don't have permission to access session management."})]})}):E?s.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),s.jsx("span",{className:"text-gray-600",children:"Loading sessions..."})]})}):Y?s.jsx("div",{className:"p-6",children:s.jsxs(r,{className:"p-8 text-center",children:[s.jsx(y,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Error Loading Sessions"}),s.jsx("p",{className:"text-gray-600 mb-4",children:Y}),s.jsx(o,{onClick:z,children:"Try Again"})]})}):s.jsxs("div",{className:"space-y-6",children:[s.jsx(t,{title:"Session Management",breadcrumb:[{label:"Sessions"}]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Academic Sessions"}),s.jsx("p",{className:"text-gray-600",children:"Manage Spring, Summer, and Fall sessions"})]}),s.jsxs(o,{onClick:P,className:"flex items-center gap-2",children:[s.jsx(w,{className:"h-4 w-4"}),"Add Session"]})]}),s.jsx("div",{className:"space-y-8",children:(()=>{const e=m.reduce((e,s)=>{const a=s.year;return e[a]||(e[a]=[]),e[a].push(s),e},{});return Object.keys(e).map(Number).sort((e,s)=>e-s).map(a=>{const t=e[a].sort((e,s)=>{const a={Spring:1,Summer:2,Fall:3};return(a[e.name]||0)-(a[s.name]||0)});return s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"border-b border-gray-200 pb-2",children:s.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:["Academic Year ",a]})}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(e=>{const a=h(e),t=g(e);return s.jsxs(r,{className:"hover:shadow-lg transition-shadow",children:[s.jsxs(n,{className:"pb-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(i,{className:"text-lg",children:j(e)}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(o,{size:"sm",variant:"outline",onClick:()=>(e=>{A(e),I(!0)})(e),children:s.jsx(v,{className:"h-4 w-4"})}),s.jsx(o,{size:"sm",variant:"outline",onClick:()=>e.id&&(async e=>{if(confirm("Are you sure you want to delete this session? This action cannot be undone."))try{await p(e),await z(),alert("Session deleted successfully")}catch(s){console.error("Error deleting session:",s),alert("Failed to delete session: "+(s instanceof Error?s.message:"Unknown error"))}})(e.id),className:"text-red-600 hover:text-red-700",children:s.jsx(S,{className:"h-4 w-4"})})]})]}),s.jsxs("div",{className:"flex gap-2 mt-2",children:[!e.isCurrent&&s.jsxs(o,{size:"sm",variant:"outline",onClick:()=>e.id&&(async e=>{if(confirm("Set this session as the current active session? This will deactivate all other sessions."))try{await f(e),await z(),alert("Session set as current successfully")}catch(s){console.error("Error setting session as current:",s),alert("Failed to set session as current: "+(s instanceof Error?s.message:"Unknown error"))}})(e.id),className:"text-blue-600 border-blue-200 hover:bg-blue-50",children:[s.jsx(N,{className:"h-4 w-4 mr-1"}),"Set as Current"]}),e.isCurrent&&s.jsxs(d,{className:"bg-blue-100 text-blue-800 border-blue-200",children:[s.jsx(N,{className:"h-3 w-3 mr-1"}),"Current Session"]})]})]}),s.jsxs(l,{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(d,{variant:"current"===a?"success":"upcoming"===a?"secondary":"error",children:"current"===a?"Active":"upcoming"===a?"Upcoming":"Past"}),e.isCurrent&&s.jsx(d,{className:"bg-blue-100 text-blue-800 border-blue-200",children:"Current"})]}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Start Date:"}),s.jsx("span",{className:"font-medium",children:e.startDate instanceof Date?e.startDate.toLocaleDateString():e.startDate.toDate().toLocaleDateString()})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"End Date:"}),s.jsx("span",{className:"font-medium",children:e.endDate instanceof Date?e.endDate.toLocaleDateString():e.endDate.toDate().toLocaleDateString()})]})]}),e.description&&s.jsx("p",{className:"text-sm text-gray-600",children:e.description}),"current"===a&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{className:"text-gray-600",children:"Progress"}),s.jsxs("span",{className:"font-medium",children:[t,"%"]})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${t}%`}})})]}),(e.registrationDeadline||e.withdrawalDeadline)&&s.jsxs("div",{className:"space-y-2 pt-2 border-t",children:[e.registrationDeadline&&s.jsxs("div",{className:"flex justify-between text-xs",children:[s.jsx("span",{className:"text-gray-500",children:"Registration Deadline:"}),s.jsx("span",{className:"font-medium",children:e.registrationDeadline instanceof Date?e.registrationDeadline.toLocaleDateString():e.registrationDeadline.toDate().toLocaleDateString()})]}),e.withdrawalDeadline&&s.jsxs("div",{className:"flex justify-between text-xs",children:[s.jsx("span",{className:"text-gray-500",children:"Withdrawal Deadline:"}),s.jsx("span",{className:"font-medium",children:e.withdrawalDeadline instanceof Date?e.withdrawalDeadline.toLocaleDateString():e.withdrawalDeadline.toDate().toLocaleDateString()})]})]})]})]},e.id)})})]},a)})})()}),0===m.length&&s.jsxs(r,{className:"p-8 text-center",children:[s.jsx(C,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No sessions found"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Create your first academic session to get started."}),s.jsx(o,{onClick:P,children:"Create Session"})]}),T&&s.jsx(O,{session:L,onClose:()=>I(!1),onSave:async e=>{try{L?(await b(L.id,e),alert("Session updated successfully")):(await D(e),alert("Session created successfully")),I(!1),await z()}catch(s){console.error("Error saving session:",s),alert("Failed to save session: "+(s instanceof Error?s.message:"Unknown error"))}}})]})}function O({session:e,onClose:t,onSave:r}){const[n,i]=a.useState({name:e?.name||"Spring",year:e?.year||(new Date).getFullYear(),startDate:e?.startDate?e.startDate instanceof Date?e.startDate.toISOString().split("T")[0]:e.startDate.toDate().toISOString().split("T")[0]:"",endDate:e?.endDate?e.endDate instanceof Date?e.endDate.toISOString().split("T")[0]:e.endDate.toDate().toISOString().split("T")[0]:"",description:e?.description||"",registrationDeadline:e?.registrationDeadline?e.registrationDeadline instanceof Date?e.registrationDeadline.toISOString().split("T")[0]:e.registrationDeadline.toDate().toISOString().split("T")[0]:"",withdrawalDeadline:e?.withdrawalDeadline?e.withdrawalDeadline instanceof Date?e.withdrawalDeadline.toISOString().split("T")[0]:e.withdrawalDeadline.toDate().toISOString().split("T")[0]:"",isCurrent:e?.isCurrent||!1}),l=(e,s)=>{i(a=>({...a,[e]:s}))};return s.jsx(m,{isOpen:!0,onClose:t,title:(e?"Edit":"Add")+" Session",description:"Manage academic session information and settings",icon:s.jsx(C,{size:24,className:"text-blue-600"}),size:"md",footer:s.jsxs("div",{className:"flex gap-3 w-full",children:[s.jsx(o,{type:"button",variant:"outline",onClick:t,className:"flex-1",children:"Cancel"}),s.jsxs(o,{type:"submit",form:"session-form",className:"flex-1",children:[e?"Update":"Create"," Session"]})]}),children:s.jsxs("form",{id:"session-form",onSubmit:e=>{if(e.preventDefault(),!(n.name&&n.year&&n.startDate&&n.endDate))return void alert("Name, year, start date, and end date are required");const s=new Date(n.startDate),a=new Date(n.endDate);if(s>=a)return void alert("Start date must be before end date");const t={name:n.name,year:parseInt(n.year.toString()),startDate:s,endDate:a,description:n.description||void 0,registrationDeadline:n.registrationDeadline?new Date(n.registrationDeadline):void 0,withdrawalDeadline:n.withdrawalDeadline?new Date(n.withdrawalDeadline):void 0,isCurrent:n.isCurrent};r(t)},className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Session Name"}),s.jsxs("select",{value:n.name,onChange:e=>l("name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[s.jsx("option",{value:"Spring",children:"Spring"}),s.jsx("option",{value:"Summer",children:"Summer"}),s.jsx("option",{value:"Fall",children:"Fall"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Year"}),s.jsx(c,{type:"number",value:n.year,onChange:e=>l("year",parseInt(e.target.value)),min:(new Date).getFullYear()-5,max:(new Date).getFullYear()+5,required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),s.jsx(c,{type:"date",value:n.startDate,onChange:e=>l("startDate",e.target.value),required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),s.jsx(c,{type:"date",value:n.endDate,onChange:e=>l("endDate",e.target.value),required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),s.jsx(c,{value:n.description,onChange:e=>l("description",e.target.value),placeholder:"Optional session description"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Registration Deadline"}),s.jsx(c,{type:"date",value:n.registrationDeadline,onChange:e=>l("registrationDeadline",e.target.value),placeholder:"Optional"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Withdrawal Deadline"}),s.jsx(c,{type:"date",value:n.withdrawalDeadline,onChange:e=>l("withdrawalDeadline",e.target.value),placeholder:"Optional"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",id:"isCurrent",checked:n.isCurrent,onChange:e=>l("isCurrent",e.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),s.jsx("label",{htmlFor:"isCurrent",className:"text-sm font-medium text-gray-700",children:"Set as Current Session"})]}),n.isCurrent&&s.jsxs("p",{className:"text-xs text-blue-600 bg-blue-50 p-2 rounded",children:[s.jsx(N,{className:"inline h-3 w-3 mr-1"}),"This will set this session as the current active session. Only one session can be current at a time."]})]})})}export{k as default};
