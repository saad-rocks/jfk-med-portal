import{u as e,j as s,f as a}from"./index-SvUTDYpM.js";import{g as t,r as l}from"./react-c0U51vzo.js";import{f as i,v as n,q as d,d as r,w as c,e as m,u as x}from"./firebase-Bz9ybdfi.js";import{C as o,b as h,a as g}from"./card-C7UMvtm_.js";import{B as j}from"./button-C_oKDOXG.js";import{I as b}from"./input-Cf836u6s.js";import{B as u}from"./badge-mKe8BOon.js";import{n as p,F as N,R as f,ad as v,f as w,U as y,C as k,o as A,m as P,D as S}from"./icons-C41eJsKq.js";import"./utils-CCUt_dAN.js";function C(){const{assignmentId:C}=t(),{role:D}=e(),[F,G]=l.useState([]),[I,L]=l.useState(null),[U,E]=l.useState(!0),[M,$]=l.useState(null),[z,B]=l.useState({points:"",feedback:""});l.useEffect(()=>{(async()=>{if(C)try{const e=i(a,"assignments",C),s=await n(e);if(s.exists()){const e=s.data();L({id:s.id,...e})}else console.error("Assignment not found:",C),L(null);const t=d(r(a,"submissions"),c("assignmentId","==",C)),l=(await m(t)).docs.map(e=>({id:e.id,...e.data()}));l.sort((e,s)=>s.submittedAt-e.submittedAt),G(l)}catch(e){console.error("Error fetching data:",e)}finally{E(!1)}else E(!1)})()},[C]);const T=e=>{const s=e.split(".").pop()?.toLowerCase();switch(s){case"pdf":case"txt":return"📄";case"doc":case"docx":return"📝";case"jpg":case"jpeg":case"png":return"🖼️";case"zip":case"rar":return"📦";default:return"📎"}},V=(e,s)=>{if(null===e)return"bg-gray-100 text-gray-700";const a=e/s*100;return a>=90?"bg-green-100 text-green-700":a>=80?"bg-blue-100 text-blue-700":a>=70?"bg-yellow-100 text-yellow-700":a>=60?"bg-orange-100 text-orange-700":"bg-red-100 text-red-700"};return U?s.jsx("div",{className:"p-6",children:s.jsx("div",{className:"flex items-center justify-center py-16",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-8 h-8 border-2 border-medical-600 border-t-transparent rounded-full animate-spin"}),s.jsx("span",{className:"text-slate-600 text-lg",children:"Loading submissions..."})]})})}):I?"teacher"!==D&&"admin"!==D?s.jsx("div",{className:"p-6",children:s.jsxs("div",{className:"text-center py-16",children:[s.jsx(p,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),s.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Access Denied"}),s.jsx("p",{className:"text-slate-600",children:"Only teachers and administrators can grade submissions."})]})}):s.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[s.jsxs("div",{className:"mb-8",children:[s.jsx("h1",{className:"text-3xl font-bold text-slate-800 mb-2",children:"Grade Submissions"}),I?s.jsxs("div",{className:"flex items-center gap-4 text-slate-600",children:[s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(N,{className:"w-5 h-5"}),I.title]}),s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(f,{className:"w-5 h-5"}),"Max Points: ",I.maxPoints]}),s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(v,{className:"w-5 h-5"}),"Weight: ",I.weight,"%"]}),s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx(w,{className:"w-5 h-5"}),"Due: ",new Date(I.dueAt).toLocaleDateString()]})]}):s.jsx("div",{className:"text-slate-500",children:"Loading assignment details..."}),s.jsx("div",{className:"mt-4",children:s.jsxs(u,{className:"bg-blue-100 text-blue-800",children:[F.length," Submission",1!==F.length?"s":""]})})]}),s.jsx("div",{className:"space-y-6",children:0===F.length?s.jsx(o,{className:"text-center py-16",children:s.jsxs(h,{children:[s.jsx(N,{className:"w-16 h-16 text-slate-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-xl font-semibold text-slate-600 mb-2",children:"No Submissions Yet"}),s.jsx("p",{className:"text-slate-500",children:"Students haven't submitted any work for this assignment."})]})}):F.map(e=>s.jsxs(o,{className:"border-2 border-slate-200 shadow-sm hover:shadow-md transition-shadow",children:[s.jsx(g,{className:"pb-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-medical-100 rounded-lg",children:s.jsx(y,{className:"w-5 h-5 text-medical-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-slate-800",children:"Student Submission"}),s.jsxs("p",{className:"text-sm text-slate-600",children:["Student ID: ",e.studentId]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(u,{className:"bg-green-100 text-green-700",children:[s.jsx(k,{className:"w-3 h-3 mr-1"}),new Date(e.submittedAt).toLocaleDateString()]}),e.grade.gradedAt&&s.jsxs(u,{className:"bg-blue-100 text-blue-700",children:[s.jsx(A,{className:"w-3 h-3 mr-1"}),"Graded"]})]})]})}),s.jsxs(h,{className:"space-y-4",children:[s.jsx("div",{className:"bg-slate-50 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-2xl",children:T(e.fileUrl)}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-slate-800",children:"Submitted File"}),s.jsx("p",{className:"text-sm text-slate-600",children:e.fileUrl.includes("http")?"File uploaded to storage":e.fileUrl})]})]}),s.jsxs("div",{className:"flex gap-2",children:[e.fileUrl.includes("http")&&s.jsx(j,{variant:"outline",size:"sm",asChild:!0,children:s.jsxs("a",{href:e.fileUrl,target:"_blank",rel:"noopener noreferrer",children:[s.jsx(P,{className:"w-4 h-4 mr-1"}),"View"]})}),s.jsx(j,{variant:"outline",size:"sm",asChild:!0,children:s.jsxs("a",{href:e.fileUrl,download:!0,children:[s.jsx(S,{className:"w-4 h-4 mr-1"}),"Download"]})})]})]})}),e.grade.gradedAt?s.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[s.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:s.jsx(f,{className:"w-5 h-5 text-green-600"})}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-green-800",children:"Graded"}),s.jsxs("p",{className:"text-sm text-green-600",children:["Graded on ",new Date(e.grade.gradedAt).toLocaleDateString()]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600 mb-1",children:"Points"}),s.jsxs(u,{className:V(e.grade.points,I?.maxPoints||100),children:[e.grade.points," / ",I?.maxPoints||"N/A"]})]}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-slate-600 mb-1",children:"Percentage"}),s.jsx(u,{className:V(e.grade.points,I?.maxPoints||100),children:e.grade.percent?`${e.grade.percent}%`:e.grade.points&&I?.maxPoints?`${Math.round(e.grade.points/I.maxPoints*100)}%`:"N/A"})]})]}),e.grade.feedback&&s.jsxs("div",{className:"mt-3",children:[s.jsx("p",{className:"text-sm font-medium text-slate-600 mb-1",children:"Feedback"}),s.jsx("div",{className:"bg-white rounded-lg p-3 border border-green-200",children:s.jsx("p",{className:"text-sm text-slate-800",children:e.grade.feedback})})]})]}):s.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[s.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:s.jsx(w,{className:"w-5 h-5 text-yellow-600"})}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-yellow-800",children:"Not Graded Yet"}),s.jsx("p",{className:"text-sm text-yellow-600",children:"This submission needs to be graded"})]})]}),M===e.id?s.jsx("div",{className:"space-y-3",children:I?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-1",children:"Points"}),s.jsx(b,{type:"number",min:"0",max:I?.maxPoints||100,value:z.points,onChange:e=>B(s=>({...s,points:e.target.value})),placeholder:"Enter points"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-1",children:"Max Points"}),s.jsx(b,{type:"number",value:I?.maxPoints||"N/A",disabled:!0,className:"bg-slate-100"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-1",children:"Percentage"}),s.jsx(b,{type:"text",value:z.points&&I?.maxPoints?`${Math.round(parseFloat(z.points)/I.maxPoints*100)}%`:"Calculating...",disabled:!0,className:"bg-slate-100",placeholder:"Auto-calculated"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-1",children:"Assignment Weight"}),s.jsx(b,{type:"text",value:`${I?.weight||0}%`,disabled:!0,className:"bg-slate-100"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-600 mb-1",children:"Feedback"}),s.jsx(b,{value:z.feedback,onChange:e=>B(s=>({...s,feedback:e.target.value})),placeholder:"Provide feedback to the student"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(j,{onClick:()=>(async e=>{if(z.points&&z.feedback)try{const s=parseFloat(z.points),t=i(a,"submissions",e),l=I?Math.round(s/I.maxPoints*100):null;await x(t,{"grade.points":s,"grade.percent":l,"grade.feedback":z.feedback,"grade.gradedAt":Date.now(),"grade.graderId":"current-user-id"}),G(a=>a.map(a=>a.id===e?{...a,grade:{...a.grade,points:s,percent:l,feedback:z.feedback,gradedAt:Date.now(),graderId:"current-user-id"}}:a)),B({points:"",feedback:""}),$(null)}catch(s){console.error("Error grading submission:",s)}})(e.id),disabled:!z.points||!z.feedback,className:"bg-green-600 hover:bg-green-700",children:[s.jsx(f,{className:"w-4 h-4 mr-1"}),"Submit Grade"]}),s.jsx(j,{variant:"outline",onClick:()=>{$(null),B({points:"",feedback:""})},children:"Cancel"})]})]}):s.jsx("div",{className:"text-center py-4 text-slate-500",children:"Loading assignment details for grading..."})}):s.jsxs(j,{onClick:()=>$(e.id),className:"bg-medical-600 hover:bg-medical-700",children:[s.jsx(f,{className:"w-4 h-4 mr-1"}),"Grade Submission"]})]})]})]},e.id))})]}):s.jsx("div",{className:"p-6",children:s.jsxs("div",{className:"text-center py-16",children:[s.jsx(p,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),s.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Assignment Not Found"}),s.jsxs("p",{className:"text-slate-600 mb-4",children:["The assignment with ID ",s.jsx("strong",{children:C})," could not be found."]}),s.jsx("p",{className:"text-sm text-slate-500 mb-6",children:"This could mean the assignment was deleted or the link is incorrect."}),s.jsxs("div",{className:"flex gap-4 justify-center",children:[s.jsx(j,{onClick:()=>window.history.back(),variant:"outline",children:"Go Back"}),s.jsx(j,{onClick:()=>window.location.href="/courses",children:"View All Courses"})]})]})})}export{C as default};
