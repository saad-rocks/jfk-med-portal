import{u as e,j as s,e as a}from"./index-SvUTDYpM.js";import{u as t,r as i}from"./react-c0U51vzo.js";import{P as r}from"./PageHeader-yfs0G1du.js";import{C as l,b as o}from"./card-C7UMvtm_.js";import{B as c}from"./button-C_oKDOXG.js";import{l as d}from"./courses-BxWJLNIE.js";import{g as n,r as m,i as u,c as h}from"./teacherAssignments-DCF62PJd.js";import"./firebase-Bz9ybdfi.js";import"./icons-C41eJsKq.js";import"./utils-CCUt_dAN.js";function j(){const j=t(),{role:x,user:f}=e(),[p,b]=i.useState(!0),[C,v]=i.useState([]),[w,S]=i.useState(null),[g,y]=i.useState({}),[N,L]=i.useState(""),[T,I]=i.useState(null);i.useEffect(()=>{(async()=>{if("teacher"===x||"admin"===x){b(!0);try{const e=await d();if(v(e.map(e=>({id:e.id,code:e.code,title:e.title,semester:e.semester}))),f?.email){const e=(await a()).find(e=>e.email?.toLowerCase()===f.email?.toLowerCase());if(e?.id){S(e.id);const s=await n(e.id),a={};s.forEach(e=>{e.courseId&&(a[e.courseId]=e.id)}),y(a)}}}finally{b(!1)}}else b(!1)})()},[x,f?.email]);const k=i.useMemo(()=>{const e=N.trim().toLowerCase();return e?C.filter(s=>s.title.toLowerCase().includes(e)||s.code.toLowerCase().includes(e)):C},[C,N]);return"teacher"!==x&&"admin"!==x?s.jsxs("div",{className:"space-y-6",children:[s.jsx(r,{title:"Select Courses to Teach",breadcrumb:[{label:"Courses",to:"/courses"},{label:"Select to Teach"}]}),s.jsx(l,{children:s.jsx(o,{className:"p-6",children:"You do not have permission to access this page."})})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsx(r,{title:"Select Courses to Teach",breadcrumb:[{label:"Courses",to:"/courses"},{label:"Select to Teach"}]}),s.jsx(l,{children:s.jsxs(o,{className:"p-6 space-y-4",children:[s.jsx("input",{value:N,onChange:e=>L(e.target.value),placeholder:"Search courses...",className:"w-full h-11 border-2 border-slate-200 rounded-xl px-3"}),p?s.jsx("div",{className:"h-40 rounded-xl bg-slate-100 animate-pulse"}):s.jsx("div",{className:"space-y-2",children:k.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl border border-slate-200 bg-white",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"font-semibold text-slate-800",children:[e.code," â€” ",e.title]}),s.jsx("div",{className:"text-sm text-slate-500",children:e.semester})]}),s.jsx(c,{size:"sm",onClick:()=>(async e=>{if(w&&f?.email){I(e.id);try{if(g[e.id]){await m(g[e.id]);const s={...g};delete s[e.id],y(s)}else{if(!(await u(e.id)))return;const s=await h({teacherId:w,teacherEmail:f.email,courseId:e.id,courseCode:e.code,courseTitle:e.title,semester:e.semester});y(a=>({...a,[e.id]:s}))}}finally{I(null)}}})(e),disabled:T===e.id,children:T===e.id?"Saving...":g[e.id]?"Unassign":"Assign to Me"})]},e.id))}),s.jsx("div",{className:"pt-2",children:s.jsx(c,{variant:"outline",onClick:()=>j("/courses"),children:"Back to Courses"})})]})})]})}export{j as default};
