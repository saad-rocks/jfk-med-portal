const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-SvUTDYpM.js","assets/react-c0U51vzo.js","assets/firebase-Bz9ybdfi.js","assets/icons-C41eJsKq.js","assets/index-IxlbvR3_.css"])))=>i.map(i=>d[i]);
import{u as e,j as t,_ as s}from"./index-SvUTDYpM.js";import{u as r,r as a,R as l}from"./react-c0U51vzo.js";import{B as i}from"./button-C_oKDOXG.js";import{I as o}from"./input-Cf836u6s.js";import{C as n,a as d,b as c}from"./card-C7UMvtm_.js";import{n as m}from"./icons-C41eJsKq.js";import"./firebase-Bz9ybdfi.js";import"./utils-CCUt_dAN.js";function u(){const u=r(),{user:x,role:h,refreshProfile:p}=e(),[f,g]=a.useState(x?.displayName||""),[b,j]=a.useState(h||"student"),[y,v]=a.useState("MD-1"),[N,w]=a.useState(!1),[D,P]=a.useState(null);l.useEffect(()=>{h&&h!==b&&j(h)},[h,b]);return x?t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-teal-50 p-4",children:t.jsxs("div",{className:"w-full max-w-md space-y-8 animate-slide-up",children:[t.jsx("div",{className:"text-center space-y-6",children:t.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[t.jsx("img",{src:"/jfk-logo.png",alt:"JFK Medical Center Logo",className:"h-24 w-24 object-cover rounded-full shadow-lg hover:shadow-xl transition-all duration-300"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h1",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 via-blue-700 to-teal-600 bg-clip-text text-transparent",children:"Complete Your Profile"}),t.jsx("p",{className:"text-slate-600",children:"Tell us a bit about yourself to get started with JFK Medical Portal"})]})]})}),t.jsxs(n,{className:"border-0 shadow-glow glass backdrop-blur-md",children:[t.jsx(d,{className:"pb-6 text-center",children:t.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-50 to-teal-50 rounded-full",children:[t.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),t.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Profile Setup"})]})}),t.jsx(c,{children:t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),w(!0),P(null),!f.trim())return P({text:"Please enter your full name",type:"error"}),void w(!1);try{const{collection:e,doc:t,setDoc:r,serverTimestamp:a,query:l,where:i,getDocs:o}=await s(async()=>{const{collection:e,doc:t,setDoc:s,serverTimestamp:r,query:a,where:l,getDocs:i}=await import("./firebase-Bz9ybdfi.js").then(e=>e.D);return{collection:e,doc:t,setDoc:s,serverTimestamp:r,query:a,where:l,getDocs:i}},[]),{db:n}=await s(async()=>{const{db:e}=await import("./index-SvUTDYpM.js").then(e=>e.o);return{db:e}},__vite__mapDeps([0,1,2,3,4])),d=l(e(n,"users"),i("uid","==",x.uid)),c=await o(d);if(c.empty){const s={uid:x.uid,name:f.trim(),email:x.email||null,role:b,status:"active",createdAt:a(),updatedAt:a()};"student"===b?(s.mdYear=y,s.studentId=`JFK${Date.now().toString().slice(-6)}`,s.enrollmentDate=a()):"teacher"===b?(s.employeeId=`JFK-FAC-${Date.now().toString().slice(-6)}`,s.hireDate=a()):"admin"===b&&(s.adminLevel="regular",s.permissions=["user_management"]);const l=t(e(n,"users"));await r(l,s),console.log(`✅ User profile created: ${x.uid} -> ${b}`),P({text:"Profile created successfully! Redirecting to dashboard...",type:"success"})}else{const e=c.docs[0];console.log(`ℹ️ User profile already exists: ${x.uid} -> ${e.data().role}`),P({text:"Profile already exists! Redirecting to dashboard...",type:"success"})}setTimeout(()=>{console.log("🔄 Refreshing user profile and redirecting..."),p(),setTimeout(()=>{console.log("🔄 Attempting navigation to dashboard..."),u("/",{replace:!0}),setTimeout(()=>{"/profile-setup"===window.location.pathname&&(console.log("🔄 Navigation failed, forcing page reload..."),window.location.href="/")},1e3)},500)},1e3)}catch(t){console.error("Profile setup error:",t),console.error("Error details:",{message:t.message,code:t.code,details:t.details,stack:t.stack});let e="Failed to create profile. Please try again.";"permission-denied"===t.code?e="Permission denied. Please check Firestore security rules.":"unavailable"===t.code?e="Firestore is temporarily unavailable. Please try again.":"cancelled"===t.code?e="Request was cancelled. Please try again.":"deadline-exceeded"===t.code&&(e="Request timed out. Please check your connection and try again."),P({text:e,type:"error"})}finally{w(!1)}},className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{htmlFor:"name",className:"text-sm font-medium text-slate-700",children:"Full Name *"}),t.jsx(o,{id:"name",type:"text",placeholder:"Enter your full name",value:f,onChange:e=>g(e.target.value),required:!0})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{htmlFor:"role",className:"text-sm font-medium text-slate-700",children:"Role *"}),t.jsxs("select",{id:"role",value:b,onChange:e=>j(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[t.jsx("option",{value:"student",children:"Medical Student"}),t.jsx("option",{value:"teacher",children:"Teacher/Faculty"}),t.jsx("option",{value:"admin",children:"Administrator"})]})]}),"student"===b&&t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{htmlFor:"mdYear",className:"text-sm font-medium text-slate-700",children:"MD Year *"}),t.jsx("select",{id:"mdYear",value:y,onChange:e=>v(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:Array.from({length:11},(e,s)=>t.jsxs("option",{value:`MD-${s+1}`,children:["MD-",s+1]},s+1))})]}),D&&t.jsx("div",{className:"p-3 rounded-lg text-sm "+("error"===D.type?"bg-red-50 text-red-700 border border-red-200":"bg-green-50 text-green-700 border border-green-200"),children:D.text}),t.jsx(i,{type:"submit",className:"w-full bg-gradient-to-r from-blue-600 to-teal-600 hover:from-blue-700 hover:to-teal-700 text-white font-medium py-3 rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl",disabled:N,children:N?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Creating Profile..."]}):"Complete Setup"}),x&&t.jsx("div",{className:"mt-4 p-3 rounded-lg bg-blue-50/80 text-blue-700 border border-blue-200/50",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"w-2 h-2 rounded-full mt-2 flex-shrink-0 bg-blue-500"}),t.jsxs("div",{className:"text-sm",children:[t.jsxs("p",{className:"font-medium mb-1",children:["Welcome back, ",x.displayName||x.email,"!"]}),t.jsx("p",{children:'If you\'ve already set up your profile, clicking "Complete Setup" will confirm your existing profile and redirect you to the dashboard.'})]})]})})]})})]}),t.jsx("div",{className:"text-center text-sm text-slate-500",children:t.jsx("p",{children:"© 2024 JFK Medical Portal. All rights reserved."})})]})}):t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 via-white to-teal-50",children:t.jsxs("div",{className:"text-center",children:[t.jsx(m,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),t.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Not Authenticated"}),t.jsx("p",{className:"text-gray-600",children:"Please log in first."})]})})}export{u as default};
