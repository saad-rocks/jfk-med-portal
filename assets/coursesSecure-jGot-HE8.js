import{f as t,v as r,u as e}from"./firebase-Bz9ybdfi.js";import{a as s,f as o,b as i}from"./index-SvUTDYpM.js";async function n(n,c){const a=s.currentUser;if(!a)throw new Error("Must be signed in");const u=t(o,"courses",n),d={code:c.code,title:c.title,credits:Number(c.credits),semester:c.semester,instructor:c.instructor,description:c.description},f=await r(u);if(!f.exists())throw new Error("Course not found");const w=f.data();let m="student";try{const t=await i(a.uid);m=t?.role||"student"}catch{}const h=w.ownerId===a.uid;if("admin"!==m){if("teacher"!==m)throw new Error("Insufficient permissions to update course");if(!h){const t=Object.entries(d).filter(([t,r])=>w[t]!==r).map(([t])=>t);if(!(t.length>0&&t.every(t=>"instructor"===t)))throw new Error("Teachers may only edit their own courses (or update instructor).")}}await e(u,d)}export{n as u};
