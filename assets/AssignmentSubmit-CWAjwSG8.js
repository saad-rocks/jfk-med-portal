import{u as e,j as s,s as t}from"./index-SvUTDYpM.js";import{R as a,r as l,u as r,g as i}from"./react-c0U51vzo.js";import{P as n}from"./PageHeader-yfs0G1du.js";import{u as d}from"./index.esm-C1BYIobo.js";import{getSubmissionForStudent as c,saveSubmission as o}from"./submissions-DoHwV8XX.js";import{B as m}from"./button-C_oKDOXG.js";import{I as x}from"./input-Cf836u6s.js";import{C as u,a as b,c as h,b as p}from"./card-C7UMvtm_.js";import{B as g}from"./badge-mKe8BOon.js";import{y as j,z as f,A as N}from"./firebase-Bz9ybdfi.js";import{o as v,a5 as y,F as w,D as z,R as S,f as k,n as D,C as A,V as U,t as F,X as C,a6 as P}from"./icons-C41eJsKq.js";import{f as R}from"./assignments-Dtn30G5f.js";import"./utils-CCUt_dAN.js";const Y=a.memo(function({assignment:a,onSuccess:r,onCancel:i}){const{user:n}=e(),[R,Y]=l.useState(!1),[I,O]=l.useState(!1),[E,L]=l.useState(null),[G,$]=l.useState([]),[T,q]=l.useState(!1),[H,B]=l.useState(null),[J,M]=l.useState([]),[V,X]=l.useState(""),{register:Z,handleSubmit:K,formState:{errors:Q},setValue:W,watch:_}=d();_("comments"),_("fileUrl"),l.useEffect(()=>{(async()=>{if(n)try{const e=await c(a.id,n.uid);e&&(L(e),W("fileUrl",e.fileUrl))}catch(e){console.error("Error checking existing submission:",e)}})()},[a.id,n,W]);const ee=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?q(!0):"dragleave"===e.type&&q(!1)},se=()=>{V.trim()&&(M([...J,V.trim()]),X(""))},te=new Date(a.dueAt)<new Date;return E&&!E.canResubmit?s.jsxs(u,{className:"w-full max-w-4xl mx-auto bg-white border border-slate-200 shadow-md rounded-2xl",children:[s.jsx(b,{className:"text-center pb-6",children:s.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[s.jsx("div",{className:"p-3 bg-green-50 rounded-xl",children:s.jsx(v,{size:24,className:"text-green-600"})}),s.jsxs("div",{children:[s.jsx(h,{className:"text-2xl font-bold text-slate-800",children:"Assignment Submitted Successfully"}),s.jsx("p",{className:"text-slate-600 mt-1",children:"Your submission has been received and is being reviewed"})]})]})}),s.jsxs(p,{className:"space-y-6",children:[s.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-xl p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 text-green-800 mb-3",children:[s.jsx(v,{size:20,className:"text-green-600"}),s.jsx("span",{className:"font-semibold text-lg",children:"Submission Confirmed"})]}),s.jsxs("p",{className:"text-green-700",children:["Submitted on ",new Date(E.submittedAt).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})," at ",new Date(E.submittedAt).toLocaleTimeString()]})]}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h4",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[s.jsx(y,{size:20,className:"text-blue-600"}),"Submission File"]}),s.jsx("div",{className:"bg-slate-50 border border-slate-200 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:s.jsx(w,{size:20,className:"text-blue-600"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"font-semibold text-slate-800 truncate",children:E.fileUrl}),s.jsx("p",{className:"text-slate-600 text-sm",children:"Submitted file"})]}),s.jsxs(m,{variant:"outline",size:"sm",children:[s.jsx(z,{size:16,className:"mr-2"}),"Download"]})]})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h4",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[s.jsx(S,{size:20,className:"text-amber-600"}),"Grading Status"]}),null!==E.grade.points?s.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[s.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:s.jsx(S,{size:20,className:"text-blue-600"})}),s.jsxs("div",{children:[s.jsxs("p",{className:"font-semibold text-slate-800 text-lg",children:[E.grade.points," / ",a.maxPoints," points"]}),null!==E.grade.percent&&s.jsxs("p",{className:"text-blue-600 font-medium",children:[E.grade.percent.toFixed(1),"%"]})]})]}),E.grade.feedback&&s.jsx("div",{className:"bg-white border border-blue-200 rounded-lg p-4",children:s.jsxs("p",{className:"text-sm text-slate-800",children:[s.jsx("strong",{children:"Feedback:"})," ",E.grade.feedback]})})]}):s.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:s.jsx(k,{size:20,className:"text-amber-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-semibold text-amber-800",children:"Pending Review"}),s.jsx("p",{className:"text-amber-700 text-sm",children:"Your submission is being graded"})]})]})})]})]}),s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(D,{size:20,className:"text-blue-600 mt-0.5"}),s.jsxs("div",{className:"text-sm text-blue-900",children:[s.jsx("p",{className:"font-medium mb-1",children:"Submission Locked"}),s.jsx("p",{className:"text-blue-800",children:"Your submission has been locked. You cannot edit or resubmit unless your teacher allows it. If you need to make changes, please contact your instructor."})]})]})}),s.jsx("div",{className:"flex justify-center gap-4 pt-6 border-t border-slate-200",children:s.jsx(m,{variant:"outline",onClick:i,className:"px-8",children:"Close"})})]})]}):(E&&E.canResubmit&&E.fileUrl&&G.length,s.jsxs(u,{className:"w-full max-w-4xl mx-auto bg-white border border-slate-200 shadow-md rounded-2xl",children:[s.jsx(b,{className:"text-center pb-6",children:s.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[s.jsx("div",{className:"p-3 bg-blue-50 rounded-xl",children:s.jsx(w,{size:24,className:"text-blue-600"})}),s.jsxs("div",{children:[s.jsx(h,{className:"text-2xl font-bold text-slate-800",children:E?.canResubmit?"Resubmit Assignment":"Submit Assignment"}),s.jsx("p",{className:"text-slate-600 mt-1",children:E?.canResubmit?"Your teacher has allowed you to resubmit this assignment":"Upload your completed work for review"})]})]})}),s.jsxs(p,{className:"space-y-8",children:[E?.canResubmit&&s.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(D,{size:20,className:"text-amber-600 mt-0.5"}),s.jsxs("div",{className:"text-sm text-amber-900",children:[s.jsx("p",{className:"font-medium mb-1",children:"Resubmission Allowed"}),s.jsx("p",{className:"text-amber-800 mb-2",children:"Your teacher has enabled resubmission for this assignment. You can update your previous submission."}),E.resubmissionNote&&s.jsxs("div",{className:"bg-white/50 rounded-lg p-3 mt-2",children:[s.jsx("p",{className:"font-medium text-amber-900 text-xs mb-1",children:"Note from Teacher:"}),s.jsx("p",{className:"text-amber-800",children:E.resubmissionNote})]}),E.submittedAt&&s.jsxs("p",{className:"text-amber-700 text-xs mt-2",children:["Previous submission: ",new Date(E.submittedAt).toLocaleDateString()]})]})]})}),s.jsxs("div",{className:"bg-slate-50 border border-slate-200 rounded-xl p-6",children:[s.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-4 mb-4",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:a.title}),s.jsx("p",{className:"text-slate-600 leading-relaxed",children:a.instructions})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsx(g,{className:`${(e=>{switch(e){case"hw":return"bg-blue-100 text-blue-700 border-blue-200";case"quiz":return"bg-green-100 text-green-700 border-green-200";case"midterm":return"bg-orange-100 text-orange-700 border-orange-200";case"final":return"bg-red-100 text-red-700 border-red-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}})(a.type)} px-3 py-1 text-sm font-medium`,children:(e=>{switch(e){case"hw":return"Homework";case"quiz":return"Quiz";case"midterm":return"Midterm";case"final":return"Final";default:return e}})(a.type)}),te&&s.jsxs(g,{variant:"error",className:"px-3 py-1 text-sm font-medium",children:[s.jsx(k,{size:14,className:"mr-1"}),"Overdue"]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(A,{size:16,className:"text-slate-500"}),s.jsxs("span",{className:"text-slate-700",children:[s.jsx("strong",{children:"Due:"})," ",new Date(a.dueAt).toLocaleDateString()]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(U,{size:16,className:"text-slate-500"}),s.jsxs("span",{className:"text-slate-700",children:[s.jsx("strong",{children:"Points:"})," ",a.maxPoints]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(S,{size:16,className:"text-slate-500"}),s.jsxs("span",{className:"text-slate-700",children:[s.jsx("strong",{children:"Weight:"})," ",a.weight,"%"]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(k,{size:16,className:"text-slate-500"}),s.jsxs("span",{className:"text-slate-700",children:[s.jsx("strong",{children:"Status:"})," ",te?"Overdue":"Active"]})]})]})]}),s.jsxs("form",{onSubmit:K(async e=>{if(!n)return;if(Date.now()>a.dueAt&&!E?.canResubmit)B("The deadline for this assignment has passed. You can no longer submit.");else if(e.fileUrl||0!==J.length){Y(!0);try{let s=e.comments||"";J.length>0&&(s+="\n\n--- Additional Links ---\n"+J.join("\n"));const t={assignmentId:a.id,courseId:a.courseId,studentId:n.uid,fileUrl:e.fileUrl||J[0]||"No file attached",comments:s,submittedAt:Date.now(),lastUpdatedAt:Date.now(),canResubmit:!1,grade:{points:null,percent:null,feedback:null,gradedAt:null,graderId:null}};await o(t),r?.()}catch(s){console.error("Error submitting assignment:",s)}finally{Y(!1)}}else B("Please upload a file or add at least one link to submit your assignment")}),className:"space-y-6",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("label",{className:"block text-lg font-semibold text-slate-800",children:"Assignment File (Optional)"}),s.jsx("p",{className:"text-sm text-slate-600",children:"Upload a file or provide links below. At least one is required."}),s.jsxs("div",{className:"relative border-2 border-dashed rounded-xl p-8 text-center transition-colors "+(T?"border-blue-400 bg-blue-50":"border-slate-300 hover:border-blue-400 hover:bg-blue-50"),onDragEnter:ee,onDragLeave:ee,onDragOver:ee,onDrop:async e=>{if(e.preventDefault(),e.stopPropagation(),q(!1),e.dataTransfer.files&&e.dataTransfer.files[0]){const l=e.dataTransfer.files[0];$([l]),B(null),O(!0);try{const e=j(t,`submissions/${a.courseId}/${a.id}/${n?.uid}/${l.name}`),s=await f(e,l),r=await N(s.ref);W("fileUrl",r),console.log("File uploaded successfully:",r)}catch(s){console.error("Error uploading file:",s),B("Failed to upload file. Please try again."),W("fileUrl",l.name)}finally{O(!1)}}},children:[s.jsx("input",{type:"file",onChange:async e=>{const s=Array.from(e.target.files||[]);if(s.length>0){const e=s[0];$([e]),B(null),O(!0);try{const s=j(t,`submissions/${a.courseId}/${a.id}/${n?.uid}/${e.name}`),l=await f(s,e),r=await N(l.ref);W("fileUrl",r),console.log("File uploaded successfully:",r)}catch(l){console.error("Error uploading file:",l),B("Failed to upload file. Please try again."),W("fileUrl",e.name)}finally{O(!1)}}},accept:".pdf,.doc,.docx,.txt,.jpg,.png,.zip,.rar",className:"hidden",id:"file-upload"}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"flex justify-center",children:s.jsx("div",{className:"p-4 bg-blue-100 rounded-xl",children:s.jsx(F,{size:32,className:"text-blue-600"})})}),s.jsx("div",{children:I?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-center gap-3",children:[s.jsx("div",{className:"w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),s.jsx("span",{className:"text-lg font-medium text-blue-600",children:"Uploading file..."})]}),s.jsx("p",{className:"text-sm text-slate-500",children:"Please wait while we upload your file"})]}):s.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer",children:[s.jsx("p",{className:"text-lg font-medium text-slate-700 mb-2",children:"Drop your file here or click to browse"}),s.jsx("p",{className:"text-slate-500 mb-4",children:"Supported formats: PDF, DOC, DOCX, TXT, JPG, PNG, ZIP, RAR"}),s.jsx(m,{variant:"outline",className:"px-6 py-2",children:"Choose File"})]})})]})]}),G.length>0&&s.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:s.jsx(w,{size:20,className:"text-green-600"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium text-slate-800",children:G[0].name}),s.jsxs("p",{className:"text-sm text-slate-600",children:[(G[0].size/1024/1024).toFixed(2)," MB"]})]}),s.jsxs(m,{type:"button",variant:"outline",size:"sm",onClick:()=>{$([]),W("fileUrl","")},className:"text-red-600 hover:text-red-700",children:[s.jsx(C,{size:16,className:"mr-1"}),"Remove"]})]})}),H&&s.jsxs("div",{className:"flex items-center gap-2 text-red-600 bg-red-50 border border-red-200 rounded-lg p-3",children:[s.jsx(D,{size:16}),s.jsx("span",{className:"text-sm",children:H})]}),Q.fileUrl&&s.jsxs("div",{className:"flex items-center gap-2 text-red-600 bg-red-50 border border-red-200 rounded-lg p-3",children:[s.jsx(D,{size:16}),s.jsx("span",{className:"text-sm",children:Q.fileUrl.message})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("label",{className:"block text-lg font-semibold text-slate-800",children:"Submission Links (Optional)"}),s.jsx("p",{className:"text-sm text-slate-600 mb-3",children:"Add links to Google Drive, GitHub, OneDrive, or any online submission. You can submit with links only."}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(x,{type:"url",value:V,onChange:e=>X(e.target.value),placeholder:"https://example.com or https://drive.google.com/...",className:"flex-1",onKeyPress:e=>{"Enter"===e.key&&(e.preventDefault(),se())}}),s.jsxs(m,{type:"button",onClick:se,variant:"outline",disabled:!V.trim(),children:[s.jsx(P,{size:16,className:"mr-2"}),"Add Link"]})]}),J.length>0&&s.jsx("div",{className:"space-y-2 mt-4",children:J.map((e,t)=>s.jsxs("div",{className:"flex items-center gap-3 bg-blue-50 border border-blue-200 rounded-lg p-3",children:[s.jsx(P,{size:16,className:"text-blue-600 flex-shrink-0"}),s.jsx("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"flex-1 text-sm text-blue-700 hover:text-blue-900 hover:underline truncate",children:e}),s.jsx(m,{type:"button",variant:"ghost",size:"sm",onClick:()=>(e=>{M(J.filter((s,t)=>t!==e))})(t),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:s.jsx(C,{size:16})})]},t))})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("label",{className:"block text-lg font-semibold text-slate-800",children:"Additional Comments (Optional)"}),s.jsx("textarea",{...Z("comments"),placeholder:"Add any additional notes, explanations, or context for your submission...",rows:4,className:"w-full px-4 py-3 border border-slate-300 rounded-lg focus:border-blue-500 focus:ring-1 focus:ring-blue-500 focus:outline-none resize-none text-slate-700 placeholder-slate-400"}),s.jsx("p",{className:"text-sm text-slate-500",children:"Use this space to provide context, explain your approach, or note any special circumstances."})]}),s.jsx("input",{type:"hidden",...Z("fileUrl")}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 pt-6 border-t border-slate-200",children:[s.jsx(m,{type:"button",variant:"outline",onClick:i,disabled:R,className:"flex-1 sm:flex-none px-8 py-3",children:"Cancel"}),s.jsx(m,{type:"submit",disabled:R||I||0===G.length&&0===J.length,className:"flex-1 sm:flex-none px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white",children:R?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Submitting..."]}):I?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Uploading..."]}):s.jsxs(s.Fragment,{children:[s.jsx(F,{size:18,className:"mr-2"}),"Submit Assignment"]})})]}),s.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(D,{size:20,className:"text-blue-600 mt-0.5"}),s.jsxs("div",{className:"text-sm text-blue-900",children:[s.jsx("p",{className:"font-medium mb-2",children:"Submission Guidelines:"}),s.jsxs("ul",{className:"space-y-1 text-blue-800",children:[s.jsxs("li",{children:["• ",s.jsx("strong",{children:"File or link required"})," - You must upload a file OR add at least one link"]}),s.jsx("li",{children:"• You can submit via file upload, links (Google Drive, GitHub, etc.), or both"}),s.jsx("li",{children:"• Ensure your submission is complete and properly formatted"}),s.jsx("li",{children:"• For link submissions, verify the sharing permissions are set correctly"}),s.jsx("li",{children:"• Check that you've included all required components"}),s.jsxs("li",{children:["• ",s.jsx("strong",{children:"No submissions after deadline"})," - You cannot submit after the due date"]}),s.jsx("li",{children:"• Once submitted, you cannot edit unless your teacher allows resubmission"})]})]})]})})]})]})]}))});function I(){const e=r(),{assignmentId:t}=i(),[a,d]=l.useState(!0),[c,o]=l.useState(null);return l.useEffect(()=>{(async()=>{if(t){d(!0);try{const e=await R(t);o(e)}finally{d(!1)}}})()},[t]),s.jsxs("div",{className:"space-y-6",children:[s.jsx(n,{title:"Submit Assignment"}),a?s.jsx("div",{className:"h-40 rounded-xl bg-slate-100 animate-pulse"}):c?s.jsx(Y,{assignment:c,onSuccess:()=>e("/assignments",{replace:!0}),onCancel:()=>e("/assignments",{replace:!0})}):s.jsx("div",{className:"p-6 rounded-xl border border-slate-200 bg-white",children:"Assignment not found."})]})}export{I as default};
