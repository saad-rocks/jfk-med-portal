import{u as e,j as s,f as a}from"./index-SvUTDYpM.js";import{u as t,g as i,r as l}from"./react-c0U51vzo.js";import{P as r}from"./PageHeader-yfs0G1du.js";import{C as n,b as c}from"./card-C7UMvtm_.js";import{I as m}from"./input-Cf836u6s.js";import{B as d}from"./button-C_oKDOXG.js";import{v as o,f as u}from"./firebase-Bz9ybdfi.js";import{j,k as x}from"./timeTracking-D3CiIPd0.js";import"./icons-C41eJsKq.js";import"./utils-CCUt_dAN.js";function p(){const p=t(),{role:f}=e(),{entryId:h}=i(),[g,y]=l.useState(!0),[v,b]=l.useState(!1),[N,S]=l.useState(""),[E,k]=l.useState(""),[C,T]=l.useState(""),[O,w]=l.useState("");if(l.useEffect(()=>{(async()=>{if(h){y(!0);try{const e=await o(u(a,"timeEntries",h));if(e.exists()){const s=e.data();S(String(s.date||"")),k(new Date(s.clockIn).toISOString().slice(11,16)),T(s.clockOut?new Date(s.clockOut).toISOString().slice(11,16):""),w(String(s.notes||""))}}finally{y(!1)}}})()},[h]),"admin"!==f&&"teacher"!==f)return s.jsxs("div",{className:"space-y-6",children:[s.jsx(r,{title:"Edit Time Entry",breadcrumb:[{label:"Time",to:"/time"},{label:"Edit Entry"}]}),s.jsx(n,{children:s.jsx(c,{className:"p-6",children:"Only staff and admins can edit time entries."})})]});return s.jsxs("div",{className:"space-y-6",children:[s.jsx(r,{title:"Edit Time Entry",breadcrumb:[{label:"Time",to:"/time"},{label:"Edit Entry"}]}),s.jsx(n,{children:s.jsx(c,{className:"p-6",children:g?s.jsx("div",{className:"h-40 rounded-xl bg-slate-100 animate-pulse"}):s.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),h&&N&&E&&C){b(!0);try{const e=new Date(`${N}T${E}`).getTime(),s=new Date(`${N}T${C}`).getTime(),a=j(e,s);await x(h,{date:N,clockIn:e,clockOut:s,totalHours:a,notes:O}),p("/time",{replace:!0})}finally{b(!1)}}},className:"space-y-4 max-w-md",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Date"}),s.jsx(m,{type:"date",value:N,onChange:e=>S(e.target.value),required:!0})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Clock In"}),s.jsx(m,{type:"time",value:E,onChange:e=>k(e.target.value),required:!0})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Clock Out"}),s.jsx(m,{type:"time",value:C,onChange:e=>T(e.target.value),required:!0})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:"text-sm font-medium",children:"Notes"}),s.jsx(m,{value:O,onChange:e=>w(e.target.value),placeholder:"Optional"})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx(d,{type:"button",variant:"outline",onClick:()=>p(-1),disabled:v,children:"Cancel"}),s.jsx(d,{type:"submit",disabled:v,children:v?"Saving...":"Save Changes"})]})]})})})]})}export{p as default};
