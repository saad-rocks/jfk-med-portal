import{u as e,j as s,e as t,f as a}from"./index-SvUTDYpM.js";import{u as r,r as i,L as l}from"./react-c0U51vzo.js";import{q as n,d as c,w as d,e as o}from"./firebase-Bz9ybdfi.js";import{l as m}from"./assignments-Dtn30G5f.js";import{g as x}from"./teacherAssignments-DCF62PJd.js";import{getSubmissionForStudent as u}from"./submissions-DoHwV8XX.js";import{l as g}from"./courses-BxWJLNIE.js";import{C as h,b,a as j,c as f}from"./card-C7UMvtm_.js";import{B as p}from"./button-C_oKDOXG.js";import{B as N}from"./badge-mKe8BOon.js";import{p as v,P as w,T as y,B as z,F as A,t as C,o as D,b as S,a3 as k,G as T,U as F,C as L,R as I,V,m as G,c as O,n as P}from"./icons-C41eJsKq.js";import"./utils-CCUt_dAN.js";function E(){const E=r(),{role:M,user:$}=e(),[q,B]=i.useState([]),[H,U]=i.useState([]),[Y,J]=i.useState(!0),[Q,R]=i.useState(null),[W,K]=i.useState("all"),[X,Z]=i.useState(""),_=async()=>{if($)try{if("teacher"===M){const e=(await t()).find(e=>e.email?.toLowerCase()===$.email?.toLowerCase());if(!e?.id)return console.error("❌ Teacher profile not found in database for email:",$.email),U([]),B([]),void J(!1);console.log("🔍 Getting teacher assignments for Firestore ID:",e.id);const s=await x(e.id);console.log("📚 Teacher assignments found:",s),U(s);const a=[];for(const t of s){console.log("🔍 Getting assignments for course:",t.courseId);const e=await m(t.courseId);console.log("📝 Course assignments found:",e);for(const s of e){const e={...s,id:s.id};a.push(e)}}console.log("📋 Total assignments found:",a),B(a)}else if("student"===M){const e=await t(),s=e.find(e=>e.email?.toLowerCase()===$.email?.toLowerCase());if(!s?.id)return console.error("❌ Student profile not found in database for email:",$.email),B([]),void J(!1);const r=n(c(a,"enrollments"),d("studentId","==",s.id),d("status","==","enrolled")),i=(await o(r)).docs.map(e=>e.data().courseId);console.log("🔍 Student enrolled in courses:",i);const l=[],x=await g();for(const t of i){console.log("🔍 Getting assignments for course:",t);const s=await m(t);console.log("📝 Course assignments found:",s);const a=x.find(e=>e.id===t);let r;if(a?.instructor){const s=e.find(e=>e.name===a.instructor);s&&(r={id:s.id,uid:s.uid,name:s.name,email:s.email,role:s.role,status:s.status,createdAt:"number"==typeof s.createdAt?s.createdAt:s.createdAt instanceof Date?s.createdAt.getTime():Date.now()})}for(const e of s){const s=await u(e.id,$.uid),t={...e,id:e.id,submission:s||void 0,course:a,instructor:r};l.push(t)}}B(l)}}catch(e){console.error("Error fetching assignments:",e)}finally{J(!1)}};i.useEffect(()=>{_()},[M,$]),i.useEffect(()=>{const e=()=>{"visible"===document.visibilityState&&_()};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[M,$]);const ee=q.filter(e=>{const s=new Date,t=new Date(e.dueAt),a=t<s;!a&&(t.getTime(),s.getTime());const r=!!e.submission,i=null!=e.submission?.grade?.gradedAt;switch(W){case"upcoming":if(a||r)return!1;break;case"overdue":if(!a||r)return!1;break;case"past":if(!a&&!r&&!i)return!1;break;case"submitted":if(!r||i)return!1;break;case"graded":if(!i)return!1}return!(X&&!e.title.toLowerCase().includes(X.toLowerCase())&&!e.instructions.toLowerCase().includes(X.toLowerCase()))}).sort((e,s)=>{const t=new Date,a=new Date(e.dueAt),r=new Date(s.dueAt),i=a<t,l=r<t;return i&&!l?-1:!i&&l?1:a.getTime()-r.getTime()}),se=(()=>{const e=new Date,s={total:q.length,upcoming:0,overdue:0,completed:0,submitted:0,graded:0};return q.forEach(t=>{const a=new Date(t.dueAt),r=!!t.submission;null!=t.submission?.grade?.gradedAt?(s.graded++,s.completed++):r?(s.submitted++,s.completed++):a<e?s.overdue++:a.getTime()-e.getTime()<=6048e5&&s.upcoming++}),s})(),te=e=>{switch(e){case"hw":return"bg-medical-100 text-medical-700 border-medical-200";case"quiz":return"bg-vital-100 text-vital-700 border-vital-200";case"midterm":return"bg-alert-100 text-alert-700 border-alert-200";case"final":return"bg-critical-100 text-critical-700 border-critical-200";default:return"bg-slate-100 text-slate-700 border-slate-200"}},ae=e=>{switch(e){case"hw":return"Homework";case"quiz":return"Quiz";case"midterm":return"Midterm";case"final":return"Final";default:return e}};return Y?s.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-8 h-8 border-2 border-medical-600 border-t-transparent rounded-full animate-spin"}),s.jsx("span",{className:"text-slate-600 text-lg",children:"Loading assignments..."})]})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"teacher"===M?"📋 Assignment Hub":"📚 My Assignment Center"}),s.jsx("p",{className:"text-slate-600 mt-2",children:"teacher"===M?"Manage assignments across all your courses":"Track and submit assignments from all your courses"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(N,{className:"bg-blue-100 text-blue-700 border-blue-200",children:[s.jsx(v,{size:14,className:"mr-1"}),se.total," Total"]}),"teacher"===M&&s.jsxs(p,{className:"flex items-center gap-2 bg-medical-600 hover:bg-medical-700",onClick:()=>E("/assignments/new"),children:[s.jsx(w,{size:16}),"Create Assignment"]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsx(h,{className:"border-l-4 border-l-red-500",children:s.jsxs(b,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Overdue"}),s.jsx("p",{className:"text-2xl font-bold text-red-600",children:se.overdue})]}),s.jsx(y,{className:"h-8 w-8 text-red-500"})]}),se.overdue>0&&s.jsx(p,{size:"sm",variant:"outline",className:"mt-2 w-full border-red-200 text-red-600 hover:bg-red-50",onClick:()=>K("overdue"),children:"View Overdue"})]})}),s.jsx(h,{className:"border-l-4 border-l-yellow-500",children:s.jsxs(b,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Due Soon"}),s.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:se.upcoming})]}),s.jsx(z,{className:"h-8 w-8 text-yellow-500"})]}),se.upcoming>0&&s.jsx(p,{size:"sm",variant:"outline",className:"mt-2 w-full border-yellow-200 text-yellow-600 hover:bg-yellow-50",onClick:()=>K("upcoming"),children:"View Upcoming"})]})}),s.jsx(h,{className:"border-l-4 border-l-green-500",children:s.jsxs(b,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"All Assignments"}),s.jsx("p",{className:"text-2xl font-bold text-green-600",children:se.total})]}),s.jsx(A,{className:"h-8 w-8 text-green-500"})]}),s.jsx(p,{size:"sm",variant:"outline",className:"mt-2 w-full border-green-200 text-green-600 hover:bg-green-50",onClick:()=>K("all"),children:"View All"})]})}),"student"===M&&s.jsxs(s.Fragment,{children:[s.jsx(h,{className:"border-l-4 border-l-blue-500",children:s.jsxs(b,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Submitted"}),s.jsx("p",{className:"text-2xl font-bold text-blue-600",children:se.submitted})]}),s.jsx(C,{className:"h-8 w-8 text-blue-500"})]}),s.jsx(p,{size:"sm",variant:"outline",className:"mt-2 w-full border-blue-200 text-blue-600 hover:bg-blue-50",onClick:()=>K("submitted"),children:"View Submitted"})]})}),s.jsx(h,{className:"border-l-4 border-l-green-500",children:s.jsxs(b,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Graded"}),s.jsx("p",{className:"text-2xl font-bold text-green-600",children:se.graded})]}),s.jsx(D,{className:"h-8 w-8 text-green-500"})]}),s.jsx(p,{size:"sm",variant:"outline",className:"mt-2 w-full border-green-200 text-green-600 hover:bg-green-50",onClick:()=>K("graded"),children:"View Graded"})]})})]}),"teacher"===M&&s.jsx(h,{className:"border-l-4 border-l-blue-500",children:s.jsxs(b,{className:"p-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Past Due"}),s.jsx("p",{className:"text-2xl font-bold text-blue-600",children:q.filter(e=>new Date(e.dueAt)<new Date).length})]}),s.jsx(D,{className:"h-8 w-8 text-blue-500"})]}),s.jsx(p,{size:"sm",variant:"outline",className:"mt-2 w-full border-blue-200 text-blue-600 hover:bg-blue-50",onClick:()=>K("past"),children:"View Past Due"})]})})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsxs(p,{variant:"all"!==W||X?"outline":"primary",size:"sm",onClick:()=>{K("all"),Z("")},className:"flex items-center gap-1",children:[s.jsx(A,{size:14}),"All Assignments (",se.total,")"]}),s.jsxs(p,{variant:"upcoming"===W?"primary":"outline",size:"sm",onClick:()=>K("upcoming"),className:"flex items-center gap-1",children:[s.jsx(z,{size:14}),"Due Soon (",se.upcoming,")"]}),s.jsxs(p,{variant:"overdue"===W?"danger":"outline",size:"sm",onClick:()=>K("overdue"),className:"flex items-center gap-1 bg-red-50 border-red-200 text-red-700 hover:bg-red-100",children:[s.jsx(y,{size:14}),"Overdue (",se.overdue,")"]}),"student"===M&&s.jsxs(s.Fragment,{children:[s.jsxs(p,{variant:"submitted"===W?"primary":"outline",size:"sm",onClick:()=>K("submitted"),className:"flex items-center gap-1",children:[s.jsx(C,{size:14}),"Submitted (",se.submitted,")"]}),s.jsxs(p,{variant:"graded"===W?"success":"outline",size:"sm",onClick:()=>K("graded"),className:"flex items-center gap-1",children:[s.jsx(D,{size:14}),"Graded (",se.graded,")"]})]}),"teacher"===M&&s.jsxs(p,{variant:"past"===W?"primary":"outline",size:"sm",onClick:()=>K("past"),className:"flex items-center gap-1",children:[s.jsx(D,{size:14}),"Past Due (",q.filter(e=>new Date(e.dueAt)<new Date).length,")"]})]}),"teacher"===M&&H.length>0&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h2",{className:"text-xl font-semibold text-slate-800 flex items-center gap-2",children:[s.jsx(S,{size:20,className:"text-medical-600"}),"Your Teaching Courses"]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:H.map(e=>s.jsxs(h,{className:"hover:shadow-lg transition-all duration-200 border border-slate-200/60 bg-white/95",children:[s.jsx(j,{className:"pb-4",children:s.jsxs(f,{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-gradient-to-r from-medical-100 to-health-100 rounded-xl",children:s.jsx(S,{size:20,className:"text-medical-600"})}),s.jsx("span",{className:"text-lg font-bold text-slate-800",children:e.courseCode})]}),s.jsx(N,{variant:"outline",className:"bg-slate-50/80 border-slate-200/60 text-slate-700",children:e.semester})]})}),s.jsxs(b,{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-slate-800 mb-1",children:e.courseTitle}),s.jsxs("p",{className:"text-sm text-slate-600",children:["Course ID: ",e.courseId]})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx(l,{to:`/courses/${e.courseId}/assignments/teacher`,children:s.jsxs(p,{variant:"outline",size:"sm",className:"w-full bg-white/80 border-slate-200/60 hover:bg-slate-50/80",children:[s.jsx(A,{size:14,className:"mr-2"}),"View Assignments"]})}),s.jsx(l,{to:`/courses/${e.courseId}/assignments/teacher`,children:s.jsxs(p,{size:"sm",className:"w-full bg-medical-600 hover:bg-medical-700",children:[s.jsx(w,{size:14,className:"mr-2"}),"Add Assignment"]})})]})]})]},e.id))})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("h2",{className:"text-xl font-semibold text-slate-800 flex items-center gap-2",children:[s.jsx(A,{size:20,className:"text-medical-600"}),"all"===W?"All Assignments":"upcoming"===W?"📅 Upcoming Assignments":"overdue"===W?"🚨 Overdue Assignments":"✅ Past Assignments"," (",ee.length,")"]}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"text",placeholder:"Search assignments...",value:X,onChange:e=>Z(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-500 focus:border-transparent"}),s.jsx(k,{size:16,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"})]})]}),0===q.length?s.jsx(h,{className:"border border-slate-200/60 bg-white/95",children:s.jsxs(b,{className:"py-16 text-center",children:[s.jsx("div",{className:"p-4 bg-slate-50/80 rounded-full w-20 h-20 mx-auto mb-4 flex items-center justify-center",children:s.jsx(A,{size:32,className:"text-slate-400"})}),s.jsx("h3",{className:"text-lg font-medium text-slate-800 mb-2",children:"teacher"===M?"No assignments created yet":"No assignments available"}),s.jsx("p",{className:"text-slate-600 max-w-md mx-auto",children:"teacher"===M?"Start by creating your first assignment for a course using the button above.":"Your instructors haven't posted any assignments yet."}),"teacher"===M&&0===H.length&&s.jsx("div",{className:"mt-4 p-3 bg-critical-50/80 border border-critical-200/60 rounded-lg",children:s.jsx("p",{className:"text-sm text-critical-700",children:"You need to be assigned to courses first. Contact an administrator."})})]})}):s.jsx("div",{className:"grid gap-4",children:ee.map(e=>{const t=(e=>{switch(e){case"hw":return S;case"quiz":return V;case"midterm":case"final":return I;default:return A}})(e.type),a=new Date,r=new Date(e.dueAt),i=r<a,l=Math.ceil((r.getTime()-a.getTime())/864e5),n=!i&&l<=3;return s.jsx(h,{className:"hover:shadow-lg transition-all duration-200 border-2 "+(i?"border-red-300 bg-red-50/50 shadow-red-100":n?"border-yellow-300 bg-yellow-50/50 shadow-yellow-100":"border-slate-200 bg-white/95 hover:border-medical-300"),children:s.jsxs(b,{className:"p-6",children:[i&&s.jsxs("div",{className:"flex items-center gap-2 mb-4 p-2 bg-red-100 border border-red-200 rounded-lg",children:[s.jsx(y,{size:16,className:"text-red-600"}),s.jsxs("span",{className:"text-sm font-medium text-red-800",children:["⚠️ Overdue by ",Math.abs(l)," day",1!==Math.abs(l)?"s":""]})]}),n&&!i&&s.jsxs("div",{className:"flex items-center gap-2 mb-4 p-2 bg-yellow-100 border border-yellow-200 rounded-lg",children:[s.jsx(z,{size:16,className:"text-yellow-600"}),s.jsx("span",{className:"text-sm font-medium text-yellow-800",children:0===l?"⏰ Due today!":1===l?"⏰ Due tomorrow!":`⏰ Due in ${l} days`})]}),s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[s.jsx("div",{className:"p-3 bg-gradient-to-r from-medical-100 to-health-100 rounded-lg",children:s.jsx(t,{size:24,className:"text-medical-600"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-xl font-bold text-slate-800 leading-tight",children:e.title}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1",children:[s.jsx(N,{className:`${te(e.type)} border font-medium`,children:ae(e.type)}),e.submission&&s.jsx(N,{className:"border "+(e.submission.grade.gradedAt?"bg-green-100 text-green-700 border-green-200":"bg-blue-100 text-blue-700 border-blue-200"),children:e.submission.grade.gradedAt?s.jsxs(s.Fragment,{children:[s.jsx(D,{size:12,className:"mr-1"}),"Graded"]}):s.jsxs(s.Fragment,{children:[s.jsx(C,{size:12,className:"mr-1"}),"Submitted"]})}),s.jsx(N,{className:"border "+(i?"bg-red-500 text-white":n?"bg-yellow-500 text-white":"bg-green-100 text-green-700"),children:i?"Overdue":n?"Due Soon":"On Track"})]})]})]}),s.jsx("p",{className:"text-slate-600 mb-4 leading-relaxed",children:e.instructions}),"student"===M&&(e.course||e.instructor)&&s.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4 p-3 bg-slate-50 rounded-lg border border-slate-200",children:[e.course&&s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(T,{size:16,className:"text-blue-600"}),s.jsx("span",{className:"font-medium text-slate-800",children:e.course.code}),s.jsxs("span",{className:"text-slate-600",children:["- ",e.course.title]})]}),e.instructor&&s.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[s.jsx(F,{size:16,className:"text-slate-500"}),s.jsxs("span",{children:["Instructor: ",s.jsx("span",{className:"font-medium text-slate-800",children:e.instructor.name})]})]})]}),"student"===M&&e.submission&&s.jsx("div",{className:"mb-4 p-3 rounded-lg border "+(e.submission.grade.gradedAt?"bg-green-50 border-green-200":"bg-blue-50 border-blue-200"),children:s.jsx("div",{className:"flex items-center gap-2 text-sm",children:e.submission.grade.gradedAt?s.jsxs(s.Fragment,{children:[s.jsx(D,{size:16,className:"text-green-600"}),s.jsxs("span",{className:"font-medium text-green-800",children:["Graded: ",e.submission.grade.points,"/",e.maxPoints," points"]}),e.submission.grade.feedback&&s.jsxs("span",{className:"text-green-700",children:["• ",e.submission.grade.feedback]})]}):s.jsxs(s.Fragment,{children:[s.jsx(C,{size:16,className:"text-blue-600"}),s.jsxs("span",{className:"font-medium text-blue-800",children:["Submitted on ",new Date(e.submission.submittedAt).toLocaleDateString()]}),s.jsx("span",{className:"text-blue-700",children:"• Pending review"})]})})}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[s.jsx(L,{size:16,className:"text-medical-500"}),s.jsxs("span",{className:i?"text-red-600 font-medium":"",children:["Due: ",new Date(e.dueAt).toLocaleDateString()]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[s.jsx(I,{size:16,className:"text-alert-500"}),s.jsxs("span",{children:[e.maxPoints," points"]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[s.jsx(V,{size:16,className:"text-vital-500"}),s.jsxs("span",{children:["Weight: ",e.weight,"%"]})]})]})]}),s.jsxs("div",{className:"flex flex-col gap-3 ml-6",children:["student"===M?s.jsx(p,{className:"flex items-center gap-2 font-medium "+(e.submission?"bg-blue-600 hover:bg-blue-700 text-white":i?"bg-red-600 hover:bg-red-700 text-white":n?"bg-yellow-600 hover:bg-yellow-700 text-white":"bg-green-600 hover:bg-green-700 text-white"),onClick:()=>{window.scrollTo({top:0,behavior:"smooth"}),E(`/assignments/${e.id}/submit`)},children:e.submission?s.jsxs(s.Fragment,{children:[s.jsx(G,{size:16}),"View Submission"]}):i?s.jsxs(s.Fragment,{children:[s.jsx(y,{size:16}),"Submit Now"]}):s.jsxs(s.Fragment,{children:[s.jsx(C,{size:16}),"Submit Assignment"]})}):s.jsxs(p,{className:"flex items-center gap-2 font-medium bg-medical-600 hover:bg-medical-700 text-white",onClick:()=>{window.scrollTo({top:0,behavior:"smooth"}),E(`/assignments/${e.id}/edit`)},children:[s.jsx(G,{size:16}),"Edit Assignment"]}),s.jsxs("div",{className:"flex gap-2",children:["teacher"===M&&s.jsxs(p,{variant:"outline",size:"sm",className:"flex items-center gap-1 text-blue-600 border-blue-200 hover:bg-blue-50",children:[s.jsx(O,{size:14}),"View Submissions"]}),s.jsx("div",{className:"flex items-center gap-1 px-2 py-1 bg-gray-100 rounded-md text-xs text-gray-600",children:i?s.jsxs(s.Fragment,{children:[s.jsx(P,{size:12,className:"text-red-600"}),"Overdue"]}):n?s.jsxs(s.Fragment,{children:[s.jsx(z,{size:12,className:"text-yellow-600"}),"Due Soon"]}):s.jsxs(s.Fragment,{children:[s.jsx(D,{size:12,className:"text-green-600"}),"Active"]})})]})]})]})]})},e.id)})})]})]})}export{E as default};
