import{u as e,e as s,j as t,h as l}from"./index-SvUTDYpM.js";import{r as a}from"./react-c0U51vzo.js";import{x as r}from"./firebase-Bz9ybdfi.js";import{listEnrollments as n,createEnrollment as i,updateEnrollmentStatus as d,deleteEnrollment as o}from"./enrollments-3oX83C0U.js";import{l as c}from"./courses-BxWJLNIE.js";import{P as m}from"./PageHeader-yfs0G1du.js";import{P as x}from"./PageActions-CxMHyczf.js";import{B as h}from"./button-C_oKDOXG.js";import{I as u}from"./input-Cf836u6s.js";import{C as j,a as p,c as b,b as f}from"./card-C7UMvtm_.js";import"./icons-C41eJsKq.js";import"./utils-CCUt_dAN.js";const g=Array.from({length:11},(e,s)=>`MD-${s+1}`),v=["enrolled","dropped","completed"];function N(){const{role:N,loading:w}=e(),[y,k]=a.useState(null),[C,S]=a.useState([]),[I,L]=a.useState([]),[A,M]=a.useState([]),[z,D]=a.useState(""),[E,U]=a.useState(""),[B,F]=a.useState(""),[P,W]=a.useState("MD-1"),[H,O]=a.useState("enrolled"),[V,$]=a.useState(!1),[G,q]=a.useState(""),[R,T]=a.useState(""),X="admin"===N,Y=(I||[]).reduce((e,s)=>(s&&s.uid&&s.name&&(e[s.uid]=s.name),e),{}),J=(C||[]).reduce((e,s)=>(s&&s.id&&s.code&&s.title&&(e[s.id]=`${s.code} - ${s.title}`),e),{});try{console.log("🔍 Debug Info:",{usersCount:I.length,coursesCount:C.length,enrollmentsCount:A.length,sampleStudentMap:Object.keys(Y).slice(0,3),sampleCourseMap:Object.keys(J).slice(0,3),sampleEnrollment:A[0]})}catch(Z){console.error("Debug logging error:",Z)}async function K(e,s){try{await d(e,s);const t=await n({courseId:G||void 0,semesterId:R||void 0});M(t)}catch(t){const e=t;k(e?.message??"Failed to update status")}}async function Q(e){try{await o(e);const s=await n({courseId:G||void 0,semesterId:R||void 0});M(s)}catch(s){const e=s;k(e?.message??"Failed to delete enrollment")}}if(a.useEffect(()=>{w||(async()=>{try{console.log("🚀 Starting to load data...");const[e,t,l]=await Promise.all([c(),s(),n({})]);console.log("✅ Data loaded successfully:",{courses:e.length,users:t.length,enrollments:l.length}),S(e||[]),L(t||[]),M(l||[])}catch(e){const s=e;console.error("❌ Error loading data:",s),k(s?.message??"Failed to load data"),S([]),L([]),M([])}})()},[w]),w)return t.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),t.jsx("span",{className:"text-gray-600",children:"Loading enrollments..."})]})});try{return X?t.jsxs("div",{className:"p-6 max-w-5xl mx-auto",children:[t.jsx(m,{title:"Enrollments",breadcrumb:[{label:"Home",to:"/"},{label:"Enrollments"}],actions:t.jsx(x,{children:t.jsx(h,{variant:"outline",onClick:()=>document.querySelector("#assign-form")?.scrollIntoView({behavior:"smooth"}),children:"Assign Student"})})}),y&&t.jsx("div",{className:"mb-6 p-4 rounded-2xl bg-gradient-to-r from-red-50 to-pink-50 border border-red-200 shadow-soft",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-8 h-8 rounded-xl bg-red-100 flex items-center justify-center",children:t.jsx("svg",{className:"w-4 h-4 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),t.jsxs("div",{children:[t.jsx("h4",{className:"font-semibold text-red-800",children:"Error"}),t.jsx("p",{className:"text-sm text-red-700",children:y})]})]})}),t.jsxs(j,{id:"assign-form",className:"mb-8",children:[t.jsx(p,{children:t.jsxs(b,{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-2xl bg-gradient-to-r from-blue-500 to-teal-500 flex items-center justify-center",children:t.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),"Assign Student to Course"]})}),t.jsx(f,{children:t.jsxs("form",{onSubmit:async function(e){if(e.preventDefault(),X&&!V)if(E&&B){k(null),$(!0);try{await i({studentId:E,courseId:B,semesterId:P,status:H});const[e,t]=await Promise.all([n({courseId:G||void 0,semesterId:R||void 0}),s()]);M(e),L(t),F(""),W("MD-1"),O("enrolled"),U(""),D("")}catch(t){const e=t;k(e?.message??"Failed to create enrollment")}finally{$(!1)}}else k("Please select both a student and a course")},className:"space-y-6",children:[t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"block text-sm font-semibold text-slate-700",children:"Student (UID or Email)"}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("div",{className:"flex-1",children:t.jsx(u,{value:z,onChange:e=>D(e.target.value),placeholder:"Enter student UID or email address",className:"h-12"})}),t.jsx(h,{type:"button",onClick:async function(){k(null);const e=z.trim();if(e)if(e.includes("@"))try{const s=r(l,"findUserByEmailOrUid"),t=await s({emailOrUid:e});U(t.data.uid)}catch(s){const e=s;k(e?.message??"User not found")}else U(e)},variant:"outline",size:"md",className:"h-12 px-6 whitespace-nowrap",children:"Find Student"})]}),E&&t.jsxs("div",{className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-xl",children:[t.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),t.jsxs("span",{className:"text-sm font-medium text-green-700",children:["Selected: ",E]})]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"block text-sm font-semibold text-slate-700",children:"Course"}),t.jsxs("select",{className:"w-full h-12 border-2 border-slate-200 rounded-xl px-4 bg-white/50 backdrop-blur-sm focus:border-blue-400 focus:bg-white transition-all duration-300 hover:border-slate-300",value:B,onChange:e=>F(e.target.value),children:[t.jsx("option",{value:"",children:"Select a course..."}),C.map(e=>t.jsxs("option",{value:e.id,children:[e.code," — ",e.title]},e.id))]})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"block text-sm font-semibold text-slate-700",children:"Semester"}),t.jsx("select",{className:"w-full h-12 border-2 border-slate-200 rounded-xl px-4 bg-white/50 backdrop-blur-sm focus:border-blue-400 focus:bg-white transition-all duration-300 hover:border-slate-300",value:P,onChange:e=>W(e.target.value),children:g.map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"block text-sm font-semibold text-slate-700",children:"Initial Status"}),t.jsx("select",{className:"w-full h-12 border-2 border-slate-200 rounded-xl px-4 bg-white/50 backdrop-blur-sm focus:border-blue-400 focus:bg-white transition-all duration-300 hover:border-slate-300",value:H,onChange:e=>O(e.target.value),children:v.map(e=>t.jsx("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]})]}),t.jsx("div",{className:"flex justify-end pt-4",children:t.jsx(h,{type:"submit",variant:"primary",size:"lg",disabled:V||!E||!B,className:"min-w-[140px]",children:V?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Assigning..."]}):"Assign Student"})})]})})]}),t.jsxs(j,{className:"mb-8",children:[t.jsx(p,{children:t.jsxs(b,{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-2xl bg-gradient-to-r from-slate-500 to-slate-600 flex items-center justify-center",children:t.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})})}),"Filter Enrollments"]})}),t.jsx(f,{children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"block text-sm font-semibold text-slate-700",children:"Course"}),t.jsxs("select",{className:"w-full h-12 border-2 border-slate-200 rounded-xl px-4 bg-white/50 backdrop-blur-sm focus:border-blue-400 focus:bg-white transition-all duration-300 hover:border-slate-300",value:G,onChange:e=>q(e.target.value),children:[t.jsx("option",{value:"",children:"All Courses"}),C.map(e=>t.jsxs("option",{value:e.id,children:[e.code," — ",e.title]},e.id))]})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("label",{className:"block text-sm font-semibold text-slate-700",children:"Semester"}),t.jsxs("select",{className:"w-full h-12 border-2 border-slate-200 rounded-xl px-4 bg-white/50 backdrop-blur-sm focus:border-blue-400 focus:bg-white transition-all duration-300 hover:border-slate-300",value:R,onChange:e=>T(e.target.value),children:[t.jsx("option",{value:"",children:"All Semesters"}),g.map(e=>t.jsx("option",{value:e,children:e},e))]})]}),t.jsx("div",{className:"flex items-end",children:t.jsx(h,{onClick:async function(){const e=await n({courseId:G||void 0,semesterId:R||void 0});M(e)},variant:"outline",size:"lg",className:"w-full h-12",children:"Apply Filters"})})]})})]}),t.jsxs(j,{children:[t.jsx(p,{children:t.jsxs(b,{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-2xl bg-gradient-to-r from-indigo-500 to-purple-500 flex items-center justify-center",children:t.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"})})}),"All Enrollments",t.jsxs("div",{className:"ml-auto px-3 py-1 bg-slate-100 rounded-full text-sm font-medium text-slate-600",children:[A.length," total"]})]})}),t.jsx(f,{children:0===A.length?t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-slate-100 rounded-2xl flex items-center justify-center",children:t.jsx("svg",{className:"w-8 h-8 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"})})}),t.jsx("h3",{className:"text-lg font-semibold text-slate-800 mb-2",children:"No enrollments found"}),t.jsx("p",{className:"text-slate-600 mb-4",children:"Get started by assigning a student to a course above."})]}):t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"hidden lg:block overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-slate-200",children:[t.jsx("th",{className:"text-left py-4 px-4 font-semibold text-slate-700",children:"Student"}),t.jsx("th",{className:"text-left py-4 px-4 font-semibold text-slate-700",children:"Course"}),t.jsx("th",{className:"text-left py-4 px-4 font-semibold text-slate-700",children:"Semester"}),t.jsx("th",{className:"text-left py-4 px-4 font-semibold text-slate-700",children:"Status"}),t.jsx("th",{className:"text-left py-4 px-4 font-semibold text-slate-700",children:"Actions"})]})}),t.jsx("tbody",{children:A.map(e=>t.jsxs("tr",{className:"border-b border-slate-100 hover:bg-slate-50 transition-colors",children:[t.jsx("td",{className:"py-4 px-4",children:t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"font-medium text-slate-800",children:Y[e.studentId]||"Unknown Student"}),t.jsx("div",{className:"font-mono text-xs text-slate-500",children:e.studentId})]})}),t.jsx("td",{className:"py-4 px-4",children:t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"font-medium text-slate-800",children:J[e.courseId]||"Unknown Course"}),t.jsx("div",{className:"font-mono text-xs text-slate-500",children:e.courseId})]})}),t.jsx("td",{className:"py-4 px-4",children:t.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e.semesterId})}),t.jsx("td",{className:"py-4 px-4",children:t.jsx("select",{className:"h-9 border-2 border-slate-200 rounded-lg px-3 bg-white focus:border-blue-400 transition-colors text-sm",value:e.status,onChange:s=>K(e.id,s.target.value),children:v.map(e=>t.jsx("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))})}),t.jsx("td",{className:"py-4 px-4",children:t.jsx(h,{onClick:()=>Q(e.id),variant:"danger",size:"sm",className:"h-9",children:"Delete"})})]},e.id))})]})}),t.jsx("div",{className:"lg:hidden space-y-4",children:A.map(e=>t.jsx("div",{className:"border border-slate-200 rounded-2xl p-4 bg-white shadow-soft",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex justify-between items-start",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-xs font-medium text-slate-500 mb-1",children:"Student"}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"font-medium text-slate-800",children:Y[e.studentId]||"Unknown Student"}),t.jsx("div",{className:"font-mono text-xs text-slate-500",children:e.studentId})]})]}),t.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e.semesterId})]}),t.jsxs("div",{children:[t.jsx("p",{className:"text-xs font-medium text-slate-500 mb-1",children:"Course"}),t.jsxs("div",{className:"space-y-1",children:[t.jsx("div",{className:"font-medium text-slate-800",children:J[e.courseId]||"Unknown Course"}),t.jsx("div",{className:"font-mono text-xs text-slate-500",children:e.courseId})]})]}),t.jsxs("div",{className:"flex gap-3 pt-2",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-xs font-medium text-slate-500 mb-2",children:"Status"}),t.jsx("select",{className:"w-full h-10 border-2 border-slate-200 rounded-lg px-3 bg-white focus:border-blue-400 transition-colors text-sm",value:e.status,onChange:s=>K(e.id,s.target.value),children:v.map(e=>t.jsx("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),t.jsx("div",{className:"flex items-end",children:t.jsx(h,{onClick:()=>Q(e.id),variant:"danger",size:"sm",className:"h-10 px-4",children:"Delete"})})]})]})},e.id))})]})})]})]}):t.jsx("div",{className:"p-6",children:t.jsxs("div",{className:"text-center py-8",children:[t.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-2xl mb-4",children:t.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),t.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Access Denied"}),t.jsx("p",{className:"text-gray-600",children:"You need admin privileges to access the enrollments page."})]})})}catch(_){return console.error("❌ Enrollment component render error:",_),t.jsx("div",{className:"p-6",children:t.jsxs("div",{className:"text-center py-8",children:[t.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-2xl mb-4",children:t.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),t.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Something went wrong"}),t.jsx("p",{className:"text-gray-600 mb-4",children:"There was an error loading the enrollments page."}),t.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Reload Page"})]})})}}export{N as default};
