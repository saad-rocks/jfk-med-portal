import{u as e,j as s,e as t}from"./index-SvUTDYpM.js";import{u as a,g as d,r}from"./react-c0U51vzo.js";import{P as l}from"./PageHeader-yfs0G1du.js";import{C as i,b as n}from"./card-C7UMvtm_.js";import{B as c}from"./button-C_oKDOXG.js";import{getCourseById as o,getEnrollmentsWithStudentDetails as m,createEnrollment as u}from"./enrollments-3oX83C0U.js";import"./firebase-Bz9ybdfi.js";import"./icons-C41eJsKq.js";import"./utils-CCUt_dAN.js";function j(){const j=a(),{role:x}=e(),{courseId:f}=d(),[p,b]=r.useState(!0),[h,v]=r.useState(null),[y,N]=r.useState(new Set),[S,g]=r.useState([]),[w,A]=r.useState(null);r.useEffect(()=>{(async()=>{if(f){b(!0);try{const e=await o(f);v(e);const s=await m(f);N(new Set(s.map(e=>e.studentId)));const a=await t();g(a.filter(e=>"student"===e.role))}finally{b(!1)}}})()},[f]);const C=r.useMemo(()=>{if(!h)return[];const e=h.semester;return S.filter(s=>s.id&&!y.has(s.id)&&(!e||s.mdYear===e))},[S,y,h]);return"admin"!==x&&"teacher"!==x?s.jsxs("div",{className:"space-y-6",children:[s.jsx(l,{title:"Add Students",breadcrumb:[{label:"Courses",to:"/courses"},{label:"Add Students"}]}),s.jsx(i,{children:s.jsx(n,{className:"p-6",children:"Only admins and teachers can manage students."})})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsx(l,{title:"Add Students",breadcrumb:[{label:"Courses",to:"/courses"},{label:h?`${h.code} — ${h.title}`:"Course"},{label:"Add Students"}]}),s.jsx(i,{children:s.jsxs(n,{className:"p-6 space-y-4",children:[s.jsx("div",{className:"text-slate-700 font-medium",children:h?`${h.code} — ${h.title}`:""}),p?s.jsx("div",{className:"h-40 rounded-xl bg-slate-100 animate-pulse"}):0===C.length?s.jsx("div",{className:"p-6 rounded-xl border border-slate-200 bg-white text-slate-600",children:"No eligible students found."}):s.jsx("div",{className:"space-y-2",children:C.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl border border-slate-200 bg-white",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-semibold text-slate-800",children:e.name}),s.jsxs("div",{className:"text-sm text-slate-500",children:[e.email," • ",e.mdYear||"MD"]})]}),s.jsxs(c,{size:"sm",onClick:s=>{s.preventDefault(),s.stopPropagation(),(async e=>{if(f){A(e);try{await u({studentId:e,courseId:f,semesterId:"current",status:"enrolled"}),N(s=>new Set([...Array.from(s),e]))}finally{A(null)}}})(e.id)},disabled:w===e.id,children:[" ",w===e.id?"Adding...":"Add"]})]},e.id))}),s.jsx("div",{className:"pt-2",children:s.jsx(c,{variant:"outline",onClick:()=>j(-1),children:"Back"})})]})})]})}export{j as default};
