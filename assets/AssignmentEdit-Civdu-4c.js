import{u as e,f as s,j as t}from"./index-SvUTDYpM.js";import{r as a,u as i,g as l}from"./react-c0U51vzo.js";import{P as r}from"./PageHeader-yfs0G1du.js";import{u as c}from"./index.esm-C1BYIobo.js";import{l as n,u as d,f as o}from"./assignments-Dtn30G5f.js";import{v as m,f as x}from"./firebase-Bz9ybdfi.js";import{B as u}from"./button-C_oKDOXG.js";import{I as h}from"./input-Cf836u6s.js";import{X as g,a4 as b,F as p,b as j,V as f,R as N,t as v}from"./icons-C41eJsKq.js";import"./utils-CCUt_dAN.js";function y({assignment:i,onSuccess:l,onCancel:r}){const{user:o,role:y}=e(),[w,A]=a.useState(!1),[z,S]=a.useState(i.attachments||[]),[q,D]=a.useState(null),[P,k]=a.useState("per-assignment"),{register:C,handleSubmit:I,formState:{errors:F},watch:M,setValue:E}=c({defaultValues:{title:i.title,type:i.type,instructions:i.instructions,dueAt:new Date(i.dueAt).toISOString().slice(0,16),weight:i.weight,maxPoints:i.maxPoints}}),T=M("type");if(a.useEffect(()=>{(async()=>{try{if(!i.courseId)return;const e=await m(x(s,"courses",i.courseId));if(e.exists()){const s=e.data();s.gradingMode&&k(s.gradingMode)}const t=(await n(i.courseId)).filter(e=>e.id!==i.id).reduce((e,s)=>e+Number(s.weight||0),0),a=Math.max(0,100-t);D({total:t,remaining:a})}catch(e){console.error("Error loading weight usage for edit:",e),D(null)}})()},[i.id,i.courseId]),"teacher"!==y)return t.jsx("div",{className:"w-full max-w-4xl mx-auto",children:t.jsx("div",{className:"bg-white/95 rounded-3xl shadow-glow border border-slate-200/60",children:t.jsx("div",{className:"p-6",children:t.jsxs("div",{className:"text-center py-16",children:[t.jsx("div",{className:"p-4 bg-critical-50/80 rounded-full w-20 h-20 mx-auto mb-4 flex items-center justify-center",children:t.jsx(g,{size:32,className:"text-critical-500"})}),t.jsx("h3",{className:"text-lg font-medium text-slate-800 mb-2",children:"Access Denied"}),t.jsx("p",{className:"text-slate-600",children:"Only teachers can edit assignments."})]})})})});const O=[{value:"hw",label:"Homework",color:"bg-medical-100 text-medical-700 border-medical-200",icon:j},{value:"quiz",label:"Quiz",color:"bg-vital-100 text-vital-700 border-vital-200",icon:f},{value:"midterm",label:"Midterm",color:"bg-alert-100 text-alert-700 border-alert-200",icon:N},{value:"final",label:"Final",color:"bg-critical-100 text-critical-700 border-critical-200",icon:N}];return t.jsx("div",{className:"w-full max-w-4xl mx-auto",children:t.jsx("div",{className:"bg-white/95 rounded-3xl shadow-glow border border-slate-200/60",children:t.jsxs("div",{className:"p-6",children:[t.jsx("div",{className:"flex items-center justify-center mb-6",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-gradient-to-r from-medical-100 to-health-100 rounded-xl",children:t.jsx(b,{size:20,className:"text-medical-600"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold text-slate-800",children:"Edit Assignment"}),t.jsx("p",{className:"text-sm text-slate-600",children:"Update assignment details and requirements"})]})]})}),t.jsxs("form",{onSubmit:I(async e=>{if(o)if(i.id){A(!0);try{const s={...e,dueAt:new Date(e.dueAt).getTime(),attachments:z};await d(i.id,s),l?.()}catch(s){console.error("Error updating assignment:",s)}finally{A(!1)}}else console.error("Assignment ID is missing")}),className:"space-y-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("h3",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[t.jsx(p,{size:20,className:"text-medical-600"}),"Assignment Details"]}),t.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-semibold text-slate-700",children:"Assignment Title *"}),t.jsx(h,{...C("title",{required:"Title is required"}),placeholder:"e.g., Chapter 5 Problem Set",className:"h-11 bg-white/90 "+(F.title?"border-critical-500 focus:border-critical-500":"")}),F.title&&t.jsx("p",{className:"text-critical-500 text-sm",children:F.title.message})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-semibold text-slate-700",children:"Assignment Type *"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:O.map(e=>{const s=e.icon;return t.jsxs("button",{type:"button",onClick:()=>E("type",e.value),className:"p-2 rounded-xl border-2 text-sm font-medium transition-all duration-200 flex items-center gap-2 justify-center "+(T===e.value?`${e.color} border-current shadow-md scale-105`:"border-slate-200/60 text-slate-700 hover:border-medical-300 hover:bg-medical-50/80 bg-white/80"),children:[t.jsx(s,{size:16}),e.label]},e.value)})})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-semibold text-slate-700",children:"Instructions *"}),t.jsx("textarea",{...C("instructions",{required:"Instructions are required"}),placeholder:"Provide clear instructions for students on what to complete, how to submit, and any specific requirements...",rows:4,className:"w-full px-3 py-3 border-2 border-slate-200/60 rounded-xl focus:border-medical-400 focus:outline-none transition-colors resize-none bg-white/90 "+(F.instructions?"border-critical-500 focus:border-critical-500":"")}),F.instructions&&t.jsx("p",{className:"text-critical-500 text-sm",children:F.instructions.message})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("h3",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[t.jsx(N,{size:20,className:"text-alert-600"}),"Grading & Due Date"]}),t.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-semibold text-slate-700",children:"Due Date & Time *"}),t.jsx(h,{type:"datetime-local",...C("dueAt",{required:"Due date is required"}),className:"h-11 bg-white/90 "+(F.dueAt?"border-critical-500 focus:border-critical-500":"")}),F.dueAt&&t.jsx("p",{className:"text-critical-500 text-sm",children:F.dueAt.message})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-semibold text-slate-700",children:"Max Points *"}),t.jsx(h,{type:"number",min:1,max:1e3,...C("maxPoints",{required:"Max points is required",min:{value:1,message:"Must be at least 1 point"},max:{value:1e3,message:"Cannot exceed 1000 points"}}),placeholder:"100",className:"h-11 bg-white/90 "+(F.maxPoints?"border-critical-500 focus:border-critical-500":"")}),F.maxPoints&&t.jsx("p",{className:"text-critical-500 text-sm",children:F.maxPoints.message})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"block text-sm font-semibold text-slate-700",children:"Weight (%) *"}),t.jsx(h,{type:"number",min:0,max:100,step:.1,disabled:"category"===P,...C("weight",{required:"Weight is required",min:{value:0,message:"Weight must be positive"},max:{value:100,message:"Weight cannot exceed 100%"},validate:e=>{if("category"===P)return!0;if(!q)return!0;const s=q.remaining+Number(i.weight||0);return Number(e)<=s+1e-6||`Only ${s.toFixed(1)}% available when considering current allocation`}}),placeholder:"10",className:"h-11 bg-white/90 "+(F.weight?"border-critical-500 focus:border-critical-500":"")}),"category"===P&&t.jsx("p",{className:"text-xs text-slate-600",children:"Category-based grading is enabled. Assignment weights are managed by category."}),q&&t.jsxs("p",{className:"text-xs text-slate-600",children:["Allocated (others): ",t.jsxs("span",{className:"font-medium",children:[q.total.toFixed(1),"%"]})," â€¢ Available: ",t.jsxs("span",{className:"font-medium",children:[(q.remaining+Number(i.weight||0)).toFixed(1),"%"]})," (target total: 100%)"]}),F.weight&&t.jsx("p",{className:"text-critical-500 text-sm",children:F.weight.message})]})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("h3",{className:"text-lg font-semibold text-slate-800 flex items-center gap-2",children:[t.jsx(v,{size:20,className:"text-vital-600"}),"Supporting Materials (Optional)"]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("input",{type:"file",multiple:!0,onChange:e=>{const s=Array.from(e.target.files||[]).map(e=>e.name);S(e=>[...e,...s])},accept:".pdf,.doc,.docx,.txt,.jpg,.png,.zip,.rar",className:"hidden",id:"file-upload-edit"}),t.jsxs("label",{htmlFor:"file-upload-edit",className:"flex items-center gap-2 px-4 py-3 border-2 border-dashed border-slate-300/60 rounded-xl cursor-pointer hover:border-vital-400 hover:bg-vital-50/80 transition-all duration-200 bg-white/80",children:[t.jsx(v,{size:16,className:"text-vital-600"}),t.jsx("span",{className:"text-slate-700",children:"Add more files"})]}),z.length>0&&t.jsx("div",{className:"space-y-2",children:z.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-slate-50/90 rounded-xl border border-slate-200/60",children:[t.jsx("div",{className:"p-2 bg-vital-100/80 rounded-lg",children:t.jsx(p,{size:16,className:"text-vital-600"})}),t.jsx("div",{className:"flex-1",children:t.jsx("p",{className:"font-medium text-slate-800",children:e})}),t.jsx(u,{type:"button",variant:"outline",size:"sm",onClick:()=>(e=>{S(s=>s.filter((s,t)=>t!==e))})(s),className:"text-critical-600 hover:text-critical-700 hover:bg-critical-50/80",children:t.jsx(g,{size:14})})]},s))})]})]}),t.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-slate-200/60",children:[t.jsx(u,{type:"button",variant:"outline",onClick:r,disabled:w,className:"px-6 bg-white/80 border-slate-200/60 hover:bg-slate-50/80",children:"Cancel"}),t.jsx(u,{type:"submit",disabled:w,variant:"primary",className:"px-6 bg-medical-600 hover:bg-medical-700",children:w?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Updating..."]}):t.jsxs(t.Fragment,{children:[t.jsx(b,{size:18,className:"mr-2"}),"Update Assignment"]})})]})]})]})})})}function w(){const e=i(),{assignmentId:s}=l(),[c,n]=a.useState(!0),[d,m]=a.useState(null);return a.useEffect(()=>{(async()=>{if(s){n(!0);try{const e=await o(s);m(e)}finally{n(!1)}}})()},[s]),t.jsxs("div",{className:"space-y-6",children:[t.jsx(r,{title:"Edit Assignment"}),c?t.jsx("div",{className:"h-40 rounded-xl bg-slate-100 animate-pulse"}):d?t.jsx(y,{assignment:d,onSuccess:()=>e("/assignments",{replace:!0}),onCancel:()=>e("/assignments",{replace:!0})}):t.jsx("div",{className:"p-6 rounded-xl border border-slate-200 bg-white",children:"Assignment not found."})]})}export{w as default};
