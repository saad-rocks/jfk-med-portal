import{u as e,f as s,j as a}from"./index-SvUTDYpM.js";import{g as t,r as n}from"./react-c0U51vzo.js";import{q as l,d as i,w as r,e as c,k as o}from"./firebase-Bz9ybdfi.js";import{C as d,a as m,c as x,b as u}from"./card-C7UMvtm_.js";import{B as h}from"./button-C_oKDOXG.js";import{B as g}from"./badge-mKe8BOon.js";import{I as p}from"./input-Cf836u6s.js";import{T as j}from"./tabs-DFGuuRa4.js";import{j as y,F as b,U as f,an as v,A as N,R as k}from"./icons-C41eJsKq.js";import"./utils-CCUt_dAN.js";const C=[{key:"clinical_rotation",label:"Clinical Rotation",icon:a.jsx(f,{className:"w-4 h-4"})},{key:"patient_interaction",label:"Patient Interaction",icon:a.jsx(v,{className:"w-4 h-4"})},{key:"procedural_skills",label:"Procedural Skills",icon:a.jsx(N,{className:"w-4 h-4"})},{key:"professionalism",label:"Professionalism",icon:a.jsx(k,{className:"w-4 h-4"})}],w={1:"Unsatisfactory",2:"Below Expectations",3:"Meets Expectations",4:"Exceeds Expectations",5:"Outstanding"};function S(){const{courseId:f}=t(),{role:v}=e(),[N,k]=n.useState([]),[S,D]=n.useState([]),[A,I]=n.useState(null),[P,E]=n.useState(!0),[T,B]=n.useState(null),[R,F]=n.useState(!1),[L,M]=n.useState({assessmentType:"clinical_rotation",patientCase:"",location:"",duration:60,historyTaking:3,physicalExamination:3,clinicalReasoning:3,differentialDiagnosis:3,treatmentPlanning:3,patientCommunication:3,professionalCommunication:3,documentation:3,punctuality:3,appearance:3,teamwork:3,ethicalBehavior:3,strengths:[],areasForImprovement:[],recommendations:[],assessorComments:""});n.useEffect(()=>{f&&O()},[f]);const O=async()=>{try{E(!0);const e=l(i(s,"courses"),r("id","==",f)),a=await c(e);a.empty||I(a.docs[0].data());const t=l(i(s,"enrollments"),r("courseId","==",f)),n=(await c(t)).docs.map(e=>e.data().studentId),o=l(i(s,"users"),r("uid","in",n)),d=(await c(o)).docs.map(e=>({...e.data(),id:e.id}));D(d);const m=l(i(s,"clinicalAssessments"),r("courseId","==",f)),x=(await c(m)).docs.map(e=>({...e.data(),id:e.id}));k(x)}catch(e){console.error("Error fetching clinical data:",e)}finally{E(!1)}},_=e=>{const s=(e.historyTaking+e.physicalExamination+e.clinicalReasoning+e.differentialDiagnosis+e.treatmentPlanning)/5,a=(e.patientCommunication+e.professionalCommunication+e.documentation)/3,t=(e.punctuality+e.appearance+e.teamwork+e.ethicalBehavior)/4;return Math.round((s+a+t)/3)},U=e=>e>=4.5?"bg-green-100 text-green-800 border-green-200":e>=3.5?"bg-blue-100 text-blue-800 border-blue-200":e>=2.5?"bg-yellow-100 text-yellow-800 border-yellow-200":"bg-red-100 text-red-800 border-red-200";return"teacher"!==v&&"admin"!==v?a.jsx("div",{className:"p-6",children:a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[a.jsx("h3",{className:"text-lg font-medium text-red-800",children:"Access Denied"}),a.jsx("p",{className:"text-red-700",children:"Only teachers and administrators can access clinical assessments."})]})}):P?a.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),a.jsx("span",{className:"text-gray-600",children:"Loading clinical assessments..."})]})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Clinical Assessments"}),a.jsxs("p",{className:"text-gray-600 mt-2",children:[A?.title," - ",A?.code," • ",A?.semester]})]}),a.jsxs(h,{onClick:()=>F(!0),children:[a.jsx(y,{className:"w-4 h-4 mr-2"}),"New Assessment"]})]}),R&&a.jsxs(d,{className:"border-2 border-blue-200",children:[a.jsx(m,{children:a.jsx(x,{children:"New Clinical Assessment"})}),a.jsxs(u,{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Student"}),a.jsxs("select",{value:T||"",onChange:e=>B(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"Choose a student..."}),S.map(e=>a.jsxs("option",{value:e.uid,children:[e.name," (",e.studentId,")"]},e.uid))]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assessment Type"}),a.jsx("select",{value:L.assessmentType,onChange:e=>M({...L,assessmentType:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:C.map(e=>a.jsx("option",{value:e.key,children:e.label},e.key))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Patient Case"}),a.jsx(p,{value:L.patientCase,onChange:e=>M({...L,patientCase:e.target.value}),placeholder:"e.g., Chest pain, SOB"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Duration (minutes)"}),a.jsx(p,{type:"number",value:L.duration,onChange:e=>M({...L,duration:parseInt(e.target.value)}),min:"15",max:"180"})]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Clinical Skills"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[{key:"historyTaking",label:"History Taking"},{key:"physicalExamination",label:"Physical Exam"},{key:"clinicalReasoning",label:"Clinical Reasoning"},{key:"differentialDiagnosis",label:"Differential Dx"},{key:"treatmentPlanning",label:"Treatment Plan"}].map(e=>a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:e.label}),a.jsx("select",{value:L[e.key],onChange:s=>M({...L,[e.key]:parseInt(s.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[1,2,3,4,5].map(e=>a.jsxs("option",{value:e,children:[e," - ",w[e]]},e))})]},e.key))})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Communication Skills"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[{key:"patientCommunication",label:"Patient Communication"},{key:"professionalCommunication",label:"Professional Communication"},{key:"documentation",label:"Documentation"}].map(e=>a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:e.label}),a.jsx("select",{value:L[e.key],onChange:s=>M({...L,[e.key]:parseInt(s.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[1,2,3,4,5].map(e=>a.jsxs("option",{value:e,children:[e," - ",w[e]]},e))})]},e.key))})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Professionalism"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[{key:"punctuality",label:"Punctuality"},{key:"appearance",label:"Appearance"},{key:"teamwork",label:"Teamwork"},{key:"ethicalBehavior",label:"Ethical Behavior"}].map(e=>a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:e.label}),a.jsx("select",{value:L[e.key],onChange:s=>M({...L,[e.key]:parseInt(s.target.value)}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[1,2,3,4,5].map(e=>a.jsxs("option",{value:e,children:[e," - ",w[e]]},e))})]},e.key))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Assessor Comments"}),a.jsx("textarea",{value:L.assessorComments,onChange:e=>M({...L,assessorComments:e.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Provide detailed feedback on the student's performance..."})]}),a.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm font-medium text-blue-900",children:"Calculated Overall Score:"}),a.jsxs(g,{className:`text-lg px-3 py-1 ${U(_(L))}`,children:[_(L).toFixed(1)," - ",w[Math.round(_(L))]]})]})}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx(h,{onClick:async()=>{if(T&&f)try{const e=_(L),a={studentId:T,courseId:f,assessorId:"current-user-id",assessmentDate:Date.now(),overallScore:e,...L,createdAt:Date.now(),updatedAt:Date.now()};await o(i(s,"clinicalAssessments"),a),F(!1),B(null),M({assessmentType:"clinical_rotation",patientCase:"",location:"",duration:60,historyTaking:3,physicalExamination:3,clinicalReasoning:3,differentialDiagnosis:3,treatmentPlanning:3,patientCommunication:3,professionalCommunication:3,documentation:3,punctuality:3,appearance:3,teamwork:3,ethicalBehavior:3,strengths:[],areasForImprovement:[],recommendations:[],assessorComments:""}),O()}catch(e){console.error("Error creating assessment:",e)}},disabled:!T,children:"Submit Assessment"}),a.jsx(h,{variant:"outline",onClick:()=>F(!1),children:"Cancel"})]})]})]}),a.jsx(j,{tabs:[{key:"overview",label:"Overview",content:a.jsx("div",{className:"space-y-4",children:S.map(e=>{const s=N.filter(s=>s.studentId===e.uid),t=s.length>0?s.reduce((e,s)=>e+s.overallScore,0)/s.length:0;return a.jsx(d,{className:"hover:shadow-md transition-shadow",children:a.jsxs(u,{className:"p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center",children:a.jsx("span",{className:"text-lg font-semibold text-purple-600",children:e.name.split(" ").map(e=>e[0]).join("")})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),a.jsxs("p",{className:"text-sm text-gray-600",children:["ID: ",e.studentId," • ",e.mdYear]})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx(g,{className:`text-lg px-3 py-1 ${U(t)}`,children:t.toFixed(1)}),a.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[s.length," assessment",1!==s.length?"s":""]})]})]}),s.length>0&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-2xl font-bold text-blue-600",children:s.filter(e=>e.overallScore>=4).length}),a.jsx("div",{className:"text-sm text-gray-600",children:"Exceeds Expectations"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-2xl font-bold text-green-600",children:s.filter(e=>e.overallScore>=3&&e.overallScore<4).length}),a.jsx("div",{className:"text-sm text-gray-600",children:"Meets Expectations"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:s.filter(e=>e.overallScore<3).length}),a.jsx("div",{className:"text-sm text-gray-600",children:"Below Expectations"})]})]}),a.jsxs("div",{className:"flex items-center justify-between mt-4",children:[a.jsxs("div",{className:"text-sm text-gray-600",children:["Last assessment: ",s.length>0?new Date(Math.max(...s.map(e=>e.assessmentDate))).toLocaleDateString():"None"]}),a.jsx(h,{variant:"outline",size:"sm",onClick:()=>{e.uid&&(B(e.uid),F(!0))},children:"Assess Student"})]})]})},e.uid)})})},{key:"assessments",label:"All Assessments",content:a.jsx("div",{className:"space-y-4",children:0===N.length?a.jsx(d,{children:a.jsxs(u,{className:"p-8 text-center",children:[a.jsx(y,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Clinical Assessments Yet"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"Start by creating your first clinical assessment for a student."}),a.jsx(h,{onClick:()=>F(!0),children:"Create Assessment"})]})}):N.map(e=>{const s=S.find(s=>s.uid===e.studentId);return a.jsx(d,{children:a.jsxs(u,{className:"p-6",children:[a.jsxs("div",{className:"flex items-start justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[(t=e.assessmentType,C.find(e=>e.key===t)?.icon||a.jsx(b,{className:"w-4 h-4"})),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:C.find(s=>s.key===e.assessmentType)?.label}),a.jsxs("p",{className:"text-sm text-gray-600",children:[s?.name," • ",new Date(e.assessmentDate).toLocaleDateString()]}),e.patientCase&&a.jsxs("p",{className:"text-sm text-gray-600",children:["Case: ",e.patientCase]})]})]}),a.jsx(g,{className:`text-lg px-3 py-1 ${U(e.overallScore)}`,children:e.overallScore.toFixed(1)})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Clinical Skills"}),a.jsxs("div",{className:"space-y-1 text-sm",children:[a.jsxs("div",{children:["History: ",e.historyTaking,"/5"]}),a.jsxs("div",{children:["Physical: ",e.physicalExamination,"/5"]}),a.jsxs("div",{children:["Reasoning: ",e.clinicalReasoning,"/5"]})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Communication"}),a.jsxs("div",{className:"space-y-1 text-sm",children:[a.jsxs("div",{children:["Patient: ",e.patientCommunication,"/5"]}),a.jsxs("div",{children:["Professional: ",e.professionalCommunication,"/5"]}),a.jsxs("div",{children:["Documentation: ",e.documentation,"/5"]})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Professionalism"}),a.jsxs("div",{className:"space-y-1 text-sm",children:[a.jsxs("div",{children:["Punctuality: ",e.punctuality,"/5"]}),a.jsxs("div",{children:["Appearance: ",e.appearance,"/5"]}),a.jsxs("div",{children:["Teamwork: ",e.teamwork,"/5"]})]})]})]}),e.assessorComments&&a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Assessor Comments"}),a.jsx("p",{className:"text-gray-700",children:e.assessorComments})]})]})},e.id);var t})})}]})]})}export{S as default};
