import{d as e,u as s,j as t,e as a}from"./index-SvUTDYpM.js";import{u as r,r as l}from"./react-c0U51vzo.js";import{l as o}from"./courses-BxWJLNIE.js";import"./firebase-Bz9ybdfi.js";import{listEnrollments as i,listEnrollmentsForStudent as n,createEnrollment as c,deleteEnrollment as d}from"./enrollments-3oX83C0U.js";import{B as m}from"./button-C_oKDOXG.js";import{C as u,b as h}from"./card-C7UMvtm_.js";import{B as x}from"./badge-mKe8BOon.js";import{g as f}from"./teacherAssignments-DCF62PJd.js";import{b as g,P as p,o as j,C as v,f as w,c as b,G as N,J as y,K as C,O as k,d as S,Q as L}from"./icons-C41eJsKq.js";import"./utils-CCUt_dAN.js";function E(){const{push:E}=e(),{user:I,role:M,mdYear:A}=s(),F=r(),[z,D]=l.useState(null),[P,$]=l.useState([]),[U,Y]=l.useState([]),[T,B]=l.useState(""),[G,H]=l.useState("enrolled"),[J,K]=l.useState(null),[O,Q]=l.useState(null),[q,R]=l.useState([]),[V,W]=l.useState([]),[X,Z]=l.useState(!1),[_,ee]=l.useState(""),[se,te]=l.useState([]),[ae,re]=l.useState(""),[le,oe]=l.useState(null),[ie,ne]=l.useState(""),[ce,de]=l.useState(!1),[me,ue]=l.useState({code:"",title:"",credits:0,semester:"MD-1",instructor:"",description:""}),[he,xe]=l.useState(""),[fe,ge]=l.useState(""),[pe,je]=l.useState([]),[ve,we]=l.useState(!1),[be,Ne]=l.useState(!0),[ye,Ce]=l.useState({}),ke=l.useMemo(()=>"admin"===M||"teacher"===M,[M]);l.useMemo(()=>{if(!ae.trim())return P;const e=ae.toLowerCase();return P.filter(s=>(s.title||"").toLowerCase().includes(e)||(s.code||"").toLowerCase().includes(e)||(s.semester||"").toLowerCase().includes(e))},[P,ae]);const Se=l.useCallback(async e=>{const s={};await Promise.all(e.map(async e=>{try{const t=(await i({courseId:e.id})).filter(e=>"enrolled"===e.status);s[e.id]=t.length}catch(t){console.error(`Error loading enrollments for course ${e.id}:`,t),s[e.id]=0}})),Ce(s)},[]);l.useEffect(()=>{(async()=>{try{Ne(!0),D(null);const e=await o();$(e),e.length>0&&await Se(e)}catch(e){const s=e;console.error("? Error loading courses:",s),D(s?.message??"Failed to load courses")}finally{Ne(!1)}})()},[Se]),l.useEffect(()=>{(async()=>{if(ke)try{we(!0);const e=(await a()).filter(e=>"teacher"===e.role&&"active"===e.status);je(e)}catch(e){console.error("Error loading teachers:",e)}finally{we(!1)}})()},[ke]),l.useEffect(()=>{(async()=>{if("student"===M&&I?.email)try{const e=(await a()).find(e=>e.email?.toLowerCase()===I.email?.toLowerCase());if(e?.id){const s=await n(e.id);Y(s)}}catch(e){console.error("Error loading student enrollments:",e),Y([])}})()},[M,I?.email]),l.useEffect(()=>{(async()=>{if("teacher"===M&&I?.email)try{const e=(await a()).find(e=>e.email?.toLowerCase()===I.email?.toLowerCase());if(e?.id){oe(e.id);const s=await f(e.id);te(s)}}catch(e){console.error("Error loading teacher assignments:",e),te([])}})()},[M,I?.email]);const Le=l.useCallback(e=>U.some(s=>s.courseId===e&&"enrolled"===s.status),[U]),Ee=l.useCallback(e=>{const s=U.find(s=>s.courseId===e&&"enrolled"===s.status);return s?.id},[U]),Ie=l.useMemo(()=>P.filter(e=>e.id&&Le(e.id)),[P,Le]),Me=l.useMemo(()=>A?P.filter(e=>e.semester===A):P,[P,A]);l.useMemo(()=>{if(!_.trim())return V;const e=_.toLowerCase();return V.filter(s=>(s.name||"").toLowerCase().includes(e)||(s.email||"").toLowerCase().includes(e)||(s.mdYear||"").toLowerCase().includes(e))},[V,_]);const Ae=l.useMemo(()=>"student"!==M?[]:Me.filter(e=>!Le(e.id)),[M,Me,Le]),Fe=l.useMemo(()=>{if("student"===M)return"enrolled"===G?Ie:Ae;if("teacher"===M){const e=se.map(e=>e.courseId);return P.filter(s=>e.includes(s.id))}return P},[M,G,Ie,Ae,se,P]),ze=l.useMemo(()=>{const e=T.trim().toLowerCase();return e?Fe.filter(s=>{const t=(s.title||"").toLowerCase(),a=(s.code||"").toLowerCase();return t.includes(e)||a.includes(e)}):Fe},[Fe,T]),De=Ae.length;return l.useEffect(()=>{"student"===M&&"enrolled"===G&&0===Ie.length&&Ae.length>0&&H("available")},[M,G,Ie.length,Ae.length]),t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h1",{className:"text-3xl font-bold text-slate-900",children:"Courses"}),t.jsxs("div",{className:"flex items-center gap-3",children:["teacher"===M&&t.jsxs(m,{variant:"outline",onClick:()=>F("/courses/teach"),className:"flex items-center gap-2 border-teal-200 text-teal-700 hover:bg-teal-50 hover:border-teal-300 hover:text-teal-800 transition-all duration-200",children:[t.jsx(g,{size:16})," Select Courses to Teach"]}),ke&&t.jsxs(m,{variant:"primary",onClick:()=>F("/courses/new"),className:"flex items-center gap-2 bg-gradient-to-r from-sky-500 to-sky-600 hover:from-sky-600 hover:to-sky-700 shadow-lg shadow-sky-500/25 border-0",children:[t.jsx(p,{size:16})," New Course"]})]})]}),"student"===M&&t.jsx("div",{className:"mb-6",children:t.jsxs("div",{className:"flex space-x-1 bg-gradient-to-r from-slate-50 to-slate-100 p-1.5 rounded-xl border border-slate-200/60 shadow-sm",children:[t.jsx("button",{onClick:()=>H("enrolled"),className:"flex-1 py-3 px-4 rounded-lg text-sm font-semibold transition-all duration-200 "+("enrolled"===G?"bg-gradient-to-r from-sky-500 to-sky-600 text-white shadow-lg shadow-sky-500/25 transform scale-[1.02]":"text-slate-600 hover:text-sky-600 hover:bg-white/70 active:scale-95"),children:t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx(j,{className:"h-4 w-4"}),"My Enrolled Courses (",Ie.length,")"]})}),t.jsx("button",{onClick:()=>H("available"),className:"flex-1 py-3 px-4 rounded-lg text-sm font-semibold transition-all duration-200 "+("available"===G?"bg-gradient-to-r from-teal-500 to-teal-600 text-white shadow-lg shadow-teal-500/25 transform scale-[1.02]":"text-slate-600 hover:text-teal-600 hover:bg-white/70 active:scale-95"),children:t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx(g,{className:"h-4 w-4"}),"Available Courses (",De,")"]})})]})}),t.jsx("div",{className:"mb-6",children:t.jsx("input",{value:T,onChange:e=>B(e.target.value),placeholder:"student"===M?"Search your courses...":"Search courses by code or title...",className:"w-full pl-3 pr-4 py-3 border-2 border-slate-200 rounded-2xl bg-white/85 focus:outline-none focus:ring-2 focus:ring-blue-400/30 focus:border-blue-400 transition-colors duration-200 hover:border-slate-300/80 text-slate-700 placeholder-slate-400"})}),z&&t.jsx("div",{className:"mb-6 p-4 rounded-2xl bg-red-50/90 text-red-700 border border-red-200/60 shadow-soft",children:z}),be?t.jsx("div",{className:"space-y-4",children:[...Array(6)].map((e,s)=>t.jsx(u,{className:"h-32 animate-pulse",children:t.jsx(h,{className:"p-6 h-full",children:t.jsxs("div",{className:"flex items-center space-x-6 h-full",children:[t.jsx("div",{className:"w-16 h-16 bg-slate-200 rounded-lg"}),t.jsxs("div",{className:"flex-1 space-y-3",children:[t.jsx("div",{className:"h-4 bg-slate-200 rounded w-3/4"}),t.jsx("div",{className:"h-3 bg-slate-200 rounded w-1/2"}),t.jsx("div",{className:"h-3 bg-slate-200 rounded w-2/3"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"h-8 bg-slate-200 rounded w-20"}),t.jsx("div",{className:"h-8 bg-slate-200 rounded w-16"})]})]})})},s))}):0===ze.length?t.jsx(u,{className:"py-12",children:t.jsxs(h,{className:"text-center",children:[t.jsx(g,{className:"h-16 w-16 mx-auto mb-4 text-slate-400"}),t.jsx("h3",{className:"text-lg font-semibold text-slate-700 mb-2",children:T?"No courses found":"student"===M&&"enrolled"===G?"No enrolled courses":"No courses available"}),t.jsx("p",{className:"text-slate-500 mb-4",children:T?"Try adjusting your search terms":"student"===M&&"enrolled"===G?"You haven't enrolled in any courses yet":"There are no courses available at the moment"}),"student"===M&&"enrolled"===G&&Ae.length>0&&t.jsx(m,{onClick:()=>H("available"),variant:"primary",className:"bg-gradient-to-r from-teal-500 to-teal-600 hover:from-teal-600 hover:to-teal-700 shadow-lg shadow-teal-500/25 border-0",children:"Browse Available Courses"})]})}):t.jsx("div",{className:"space-y-4",children:ze.map(e=>{const s=ye[e.id]||0,r=Le(e.id),l="student"===M&&!r,o="student"===M&&r;return t.jsx(u,{className:"group hover:shadow-xl hover:shadow-sky-500/10 hover:border-sky-200 transition-all duration-300 cursor-pointer overflow-hidden",onClick:()=>function(e){"student"===M&&e.id&&!Le(e.id)||(e.id?(console.log("?? Navigating to course details:",e.id,e.code,e.title),window.scrollTo({top:0,behavior:"smooth"}),F(`/courses/${e.id}`)):console.log("? Course has no ID:",e))}(e),children:t.jsx(h,{className:"p-0",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:`w-20 h-20 flex items-center justify-center bg-gradient-to-br ${(e=>{const s=["from-blue-500 to-blue-600","from-green-500 to-green-600","from-purple-500 to-purple-600","from-red-500 to-red-600","from-orange-500 to-orange-600","from-teal-500 to-teal-600","from-pink-500 to-pink-600","from-indigo-500 to-indigo-600"];return s[e.charCodeAt(0)%s.length]})(e.title)} text-white`,children:t.jsx("span",{className:"text-2xl font-bold",children:e.title.charAt(0).toUpperCase()})}),t.jsx("div",{className:"flex-1 p-6",children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1 pr-4",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("h3",{className:"text-xl font-semibold text-slate-800 group-hover:text-sky-600 transition-colors",children:e.title}),t.jsx(x,{variant:"outline",className:"text-xs font-medium",children:e.code})]}),e.description&&t.jsx("p",{className:"text-slate-600 text-sm mb-3 line-clamp-2",children:e.description}),t.jsxs("div",{className:"flex items-center gap-6 text-sm text-slate-500",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(v,{className:"h-4 w-4"}),t.jsx("span",{children:e.semester})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(w,{className:"h-4 w-4"}),t.jsxs("span",{children:[e.credits," ",1===e.credits?"credit":"credits"]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(b,{className:"h-4 w-4"}),t.jsxs("span",{children:[s," ",1===s?"student":"students"]})]}),e.instructor&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(N,{className:"h-4 w-4"}),t.jsx("span",{children:e.instructor})]})]})]}),t.jsxs("div",{className:"flex flex-col items-end gap-3",children:["student"===M&&t.jsx("div",{className:"flex items-center gap-2",children:r?t.jsxs(x,{className:"bg-green-100 text-green-800 border-green-200",children:[t.jsx(j,{className:"h-3 w-3 mr-1"}),"Enrolled"]}):t.jsx(x,{variant:"outline",className:"text-slate-600",children:"Available"})}),t.jsxs("div",{className:"flex items-center gap-2",children:[l&&t.jsxs(m,{size:"sm",onClick:s=>{s.stopPropagation(),async function(e){if(I?.uid)try{console.log("?? Enrolling user:",I.email,"with UID:",I.uid);const s=(await a()).find(e=>e.email?.toLowerCase()===I.email?.toLowerCase());if(!s?.id)throw new Error("User profile not found in database");console.log("?? Found user document ID:",s.id);const t={studentId:s.id,courseId:e,semesterId:"current",status:"enrolled"};console.log("?? Creating enrollment with data:",t),await c(t);const r=await n(s.id);console.log("?? Student enrollments after enrollment:",r),Y(r),await Se(P),E({variant:"success",title:"Enrolled successfully",description:"You have been enrolled in this course"})}catch(s){const t=s;console.error("? Enrollment error:",t),D(t?.message??"Failed to enroll in course"),E({variant:"error",title:"Failed to enroll",description:t?.message})}}(e.id)},className:"bg-gradient-to-r from-sky-500 to-sky-600 hover:from-sky-600 hover:to-sky-700 shadow-lg shadow-sky-500/25",children:[t.jsx(y,{className:"h-4 w-4 mr-1"}),"Enroll"]}),o&&t.jsxs(m,{size:"sm",variant:"outline",onClick:s=>{s.stopPropagation();const t=Ee(e.id);t&&async function(e){if(confirm("Are you sure you want to unenroll from this course?"))try{if(await d(e),I?.uid){const e=(await a()).find(e=>e.email?.toLowerCase()===I.email?.toLowerCase());if(e?.id){const s=await n(e.id);Y(s),await Se(P)}}E({variant:"success",title:"Unenrolled successfully",description:"You have been unenrolled from this course"})}catch(s){const t=s;D(t?.message??"Failed to unenroll from course"),E({variant:"error",title:"Failed to unenroll",description:t?.message})}}(t)},className:"text-red-600 border-red-200 hover:bg-red-50",children:[t.jsx(C,{className:"h-4 w-4 mr-1"}),"Unenroll"]}),("admin"===M||"teacher"===M)&&t.jsx(t.Fragment,{children:t.jsxs(m,{size:"sm",variant:"outline",onClick:s=>{s.stopPropagation(),F(`/courses/${e.id}/edit`)},className:"border-slate-200 text-slate-600 hover:bg-slate-50 hover:border-slate-300 hover:text-slate-800",children:[t.jsx(k,{className:"h-4 w-4 mr-1"}),"Edit"]})}),"admin"===M&&t.jsxs(m,{size:"sm",variant:"outline",onClick:s=>{s.stopPropagation(),F(`/courses/${e.id}/assign-instructor`)},className:"border-teal-200 text-teal-700 hover:bg-teal-50 hover:border-teal-300 hover:text-teal-800",children:[t.jsx(S,{className:"h-4 w-4 mr-1"}),"Instructor"]}),t.jsx("div",{className:"ml-2 opacity-0 group-hover:opacity-100 transition-opacity",children:t.jsx(L,{className:"h-5 w-5 text-sky-400"})})]})]})]})})]})})},e.id)})})]})}Array.from({length:11},(e,s)=>`MD-${s+1}`);export{E as default};
