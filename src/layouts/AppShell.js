import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import { Menu, Bell, Search, Settings, LogOut, Home, BookOpen, ClipboardList, GraduationCap, Users, Layers, CalendarCheck, FileText, Sun, User, Stethoscope, Heart, UserCheck, Calendar } from "lucide-react";
import { Link, NavLink, Outlet, useNavigate, useLocation } from "react-router-dom";
import { useState, useEffect } from "react";
import { signOut } from "firebase/auth";
import { auth } from "../firebase";
import { ToastContainer, ToastProvider } from "../components/ui/toast";
import { useRole } from "../hooks/useRole";
export default function AppShell() {
    const [sidebarOpen, setSidebarOpen] = useState(false);
    const [searchFocused, setSearchFocused] = useState(false);
    const { user, role, mdYear } = useRole();
    const navigate = useNavigate();
    const location = useLocation();
    // Debug: Log role for troubleshooting
    console.log('ðŸ”§ AppShell - Current role:', role, 'User email:', user?.email);
    // Close sidebar on mobile when route changes
    useEffect(() => {
        setSidebarOpen(false);
    }, [location.pathname]);
    const handleSignOut = async () => {
        try {
            await signOut(auth);
            navigate('/login');
        }
        catch (error) {
            console.error('Sign out error:', error);
        }
    };
    return (_jsx(ToastProvider, { children: _jsxs("div", { className: "min-h-screen bg-gradient-to-br from-blue-50/30 via-white to-teal-50/20 page-transition", children: [_jsx("header", { className: "sticky top-0 z-40 glass border-b border-white/20 shadow-soft", children: _jsx("div", { className: "max-w-7xl mx-auto px-4 sm:px-6 lg:px-8", children: _jsxs("div", { className: "h-16 flex items-center justify-between", children: [_jsxs("div", { className: "flex items-center gap-4", children: [_jsx("button", { className: "p-2.5 rounded-xl hover:bg-white/50 transition-all duration-200 lg:hidden focus-ring interactive", onClick: () => setSidebarOpen(!sidebarOpen), "aria-label": "Toggle sidebar", children: _jsx(Menu, { size: 20, className: "text-slate-600" }) }), _jsxs(Link, { to: "/", className: "flex items-center gap-3 group", children: [_jsxs("div", { className: "relative", children: [_jsx("div", { className: "h-10 w-10 rounded-2xl bg-gradient-to-r from-blue-500 to-teal-500 text-white flex items-center justify-center font-bold text-sm shadow-glow group-hover:shadow-glow transition-all duration-300 interactive", children: "J" }), _jsx("div", { className: "absolute -bottom-1 -right-1 h-3.5 w-3.5 bg-green-500 rounded-full border-2 border-white flex items-center justify-center pulse-vital", children: _jsx(Heart, { size: 6, className: "text-white" }) })] }), _jsxs("div", { className: "hidden sm:block", children: [_jsx("span", { className: "font-bold text-lg bg-gradient-to-r from-blue-600 to-teal-600 bg-clip-text text-transparent", children: "JFK Medical Portal" }), _jsx("p", { className: "text-xs text-slate-500 -mt-0.5 font-medium", children: "Excellence in Medicine" })] })] })] }), _jsx("div", { className: "hidden md:flex flex-1 max-w-lg mx-8", children: _jsxs("div", { className: `relative w-full transition-all duration-300 ${searchFocused ? 'scale-105' : ''}`, children: [_jsx("div", { className: "absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none", children: _jsx(Search, { size: 18, className: `transition-colors duration-200 ${searchFocused ? 'text-blue-500' : 'text-slate-400'}` }) }), _jsx("input", { placeholder: "Search courses, assignments, students...", className: "w-full pl-12 pr-4 py-3 rounded-2xl border-2 border-slate-200/60 bg-white/60 backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-blue-400/30 focus:border-blue-400 focus:bg-white transition-all duration-300 hover:border-slate-300/80 text-slate-700 placeholder-slate-400", onFocus: () => setSearchFocused(true), onBlur: () => setSearchFocused(false) }), _jsx("div", { className: `absolute inset-0 rounded-2xl bg-gradient-to-r from-medical-400/5 to-health-400/5 opacity-0 transition-opacity duration-300 pointer-events-none ${searchFocused ? 'opacity-100' : ''}` })] }) }), _jsxs("div", { className: "flex items-center gap-3", children: [_jsx("button", { className: "p-2.5 rounded-xl hover:bg-white/50 transition-all duration-200 md:hidden focus-ring interactive", children: _jsx(Search, { size: 18, className: "text-slate-600" }) }), _jsx("div", { className: "relative", children: _jsxs("button", { className: "p-2.5 rounded-xl hover:bg-white/50 transition-all duration-200 focus-ring interactive", children: [_jsx(Bell, { size: 18, className: "text-slate-600" }), _jsx("div", { className: "absolute -top-0.5 -right-0.5 h-5 w-5 bg-gradient-to-r from-red-500 to-orange-500 rounded-full flex items-center justify-center shadow-soft pulse-vital", children: _jsx("span", { className: "text-2xs font-bold text-white", children: "3" }) })] }) }), _jsx("button", { className: "p-2.5 rounded-xl hover:bg-white/50 transition-all duration-200 focus-ring interactive", children: _jsx(Sun, { size: 18, className: "text-slate-600" }) }), _jsxs("div", { className: "flex items-center gap-4 pl-3 border-l border-slate-200/60", children: [_jsxs("div", { className: "hidden sm:block text-right", children: [_jsxs("div", { className: "flex items-center gap-2 justify-end", children: [_jsx("p", { className: "text-sm font-semibold text-slate-700", children: user?.displayName || 'Medical Student' }), role === 'student' && mdYear && (_jsx("span", { className: "px-2.5 py-1 bg-gradient-to-r from-blue-100 to-teal-100 text-blue-700 text-xs font-bold rounded-full border border-blue-200/50 shadow-soft", children: mdYear }))] }), _jsx("p", { className: "text-xs text-slate-500 font-medium", children: user?.email })] }), _jsxs("div", { className: "flex items-center gap-2", children: [_jsx("div", { className: "h-9 w-9 rounded-xl bg-gradient-to-r from-blue-500 to-teal-500 flex items-center justify-center shadow-glow interactive", children: _jsx(User, { size: 16, className: "text-white" }) }), _jsx("button", { className: "p-2.5 rounded-xl hover:bg-red-50 hover:text-red-600 transition-all duration-200 focus-ring interactive", onClick: handleSignOut, title: "Sign out", children: _jsx(LogOut, { size: 16 }) })] })] })] })] }) }) }), _jsx("div", { className: "max-w-7xl mx-auto px-4 sm:px-6 lg:px-8", children: _jsxs("div", { className: "flex gap-6 py-6", children: [_jsxs("aside", { className: `
            ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'} 
            lg:translate-x-0 fixed lg:static inset-y-0 left-0 z-30 w-72 
            transition-transform duration-300 ease-in-out lg:transition-none
            pt-16 lg:pt-0
          `, children: [sidebarOpen && (_jsx("div", { className: "fixed inset-0 bg-slate-900/20 backdrop-blur-sm lg:hidden animate-fade-in", onClick: () => setSidebarOpen(false) })), _jsxs("nav", { className: "relative glass rounded-3xl border border-white/30 p-6 shadow-glow m-2 lg:m-0", children: [_jsxs("div", { className: "space-y-2", children: [_jsx("div", { className: "mb-6", children: _jsx("h3", { className: "text-xs font-bold text-slate-500 uppercase tracking-wider mb-3", children: "Academic Portal" }) }), _jsx(SidebarLink, { to: "/", icon: _jsx(Home, { size: 20 }), label: "Dashboard" }), _jsx(SidebarLink, { to: "/courses", icon: _jsx(BookOpen, { size: 20 }), label: "Courses" }), _jsx(SidebarLink, { to: "/enrollments", icon: _jsx(Users, { size: 20 }), label: "Enrollments" }), role === 'admin' ? (_jsxs(_Fragment, { children: [_jsx(SidebarLink, { to: "/manage-users", icon: _jsx(UserCheck, { size: 20 }), label: "Manage Users" }), _jsx(SidebarLink, { to: "/sessions", icon: _jsx(Calendar, { size: 20 }), label: "Sessions" })] })) : (_jsx(SidebarLink, { to: "/courses/MD-1/assignments", icon: _jsx(ClipboardList, { size: 20 }), label: "Assignments" })), _jsx(SidebarLink, { to: "/gradebook", icon: _jsx(GraduationCap, { size: 20 }), label: "Gradebook" }), _jsx(SidebarLink, { to: "/attendance", icon: _jsx(CalendarCheck, { size: 20 }), label: "Attendance" }), _jsx(SidebarLink, { to: "/announcements", icon: _jsx(FileText, { size: 20 }), label: "Announcements" }), _jsx(SidebarLink, { to: "/semesters", icon: _jsx(Layers, { size: 20 }), label: "Semesters" }), _jsxs("div", { className: "pt-6 mt-6 border-t border-slate-200/60", children: [_jsx("h3", { className: "text-xs font-bold text-slate-500 uppercase tracking-wider mb-3", children: "Account" }), _jsx(SidebarLink, { to: "/settings", icon: _jsx(Settings, { size: 20 }), label: "Settings" })] })] }), _jsx("div", { className: "mt-8 p-4 bg-gradient-to-r from-blue-50/80 to-teal-50/80 rounded-2xl border border-blue-100/50 backdrop-blur-sm", children: _jsxs("div", { className: "flex items-center gap-3 text-xs text-slate-600", children: [_jsx("div", { className: "p-2 bg-white/60 rounded-lg", children: _jsx(Stethoscope, { size: 14, className: "text-blue-500" }) }), _jsxs("div", { children: [_jsx("p", { className: "font-semibold text-slate-700", children: "Medical Excellence" }), _jsx("p", { className: "text-slate-500 mt-0.5", children: "Empowering Future Physicians" })] })] }) })] })] }), _jsx("main", { className: "flex-1 min-w-0", children: _jsx("div", { className: "animate-fade-in", children: _jsx(Outlet, {}) }) })] }) }), _jsx(ToastContainer, {})] }) }));
}
function SidebarLink({ to, icon, label }) {
    return (_jsx(NavLink, { to: to, end: true, className: ({ isActive }) => `
        flex items-center gap-4 px-4 py-3.5 rounded-2xl text-sm font-semibold transition-all duration-300 group relative overflow-hidden
        ${isActive
            ? 'bg-gradient-to-r from-blue-500 to-teal-500 text-white shadow-glow'
            : 'text-slate-600 hover:bg-white/60 hover:text-slate-800 hover:shadow-soft'}
      `, children: ({ isActive }) => (_jsxs(_Fragment, { children: [_jsx("div", { className: `absolute inset-0 bg-gradient-to-r from-blue-400/10 to-teal-400/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl ${isActive ? 'opacity-0' : ''}` }), _jsx("span", { className: `relative z-10 transition-all duration-300 ${isActive
                        ? 'text-white drop-shadow-sm'
                        : 'text-slate-500 group-hover:text-blue-500'}`, children: icon }), _jsx("span", { className: `relative z-10 transition-all duration-300 ${isActive
                        ? 'text-white drop-shadow-sm'
                        : 'group-hover:text-slate-800'}`, children: label }), isActive && (_jsx("div", { className: "absolute right-3 top-1/2 -translate-y-1/2 w-2 h-2 bg-white/80 rounded-full animate-pulse" }))] })) }));
}
